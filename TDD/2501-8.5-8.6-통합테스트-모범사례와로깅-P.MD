## 8.5 í†µí•© í…ŒìŠ¤íŠ¸ ëª¨ë²” ì‚¬ë¡€

### 8.5.1 ë„ë©”ì¸ ëª¨ë¸ ê²½ê³„ ëª…ì‹œí•˜ê¸°

* ë„ë©”ì¸ ëª¨ë¸ì€ `â€œë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì§€ì‹ì˜ ëª¨ìŒâ€`ì´ë¯€ë¡œ ì½”ë“œë² ì´ìŠ¤ì˜ **ëª…ì‹œì ì´ê³  ì˜ ì•Œë ¤ì§„ ìœ„ì¹˜**ì— ë‘ì–´ë¼. ì´ë ‡ê²Œ í•´ì•¼ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(ë„ë©”ì¸/ì•Œê³ ë¦¬ì¦˜)ì™€ í†µí•© í…ŒìŠ¤íŠ¸(ì»¨íŠ¸ë¡¤ëŸ¬)ì˜ ê²½ê³„ë¥¼ ì„ ëª…í•˜ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤. \[p.291]&#x20;
* ë„ë©”ì¸ ë¡œì§ì´ í•˜ë‚˜ì˜ ìš°ì‚° ì•„ë˜ì— ìˆê³  ì—¬ê¸°ì €ê¸° í©ì–´ì§€ì§€ ì•Šê²Œ í•˜ë¼(ì–´ì…ˆë¸”ë¦¬/ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë“± êµ¬ì¡°ëŠ” ììœ ). \[p.291â€“292]&#x20;

> **ë‚´ ìƒê°**: í…ŒìŠ¤íŠ¸ ì „ëµ(ë‹¨ìœ„ vs í†µí•©)ì„ ê²°ì •í•˜ëŠ” ê¸°ì¤€ì€ â€œê²½ê³„â€ë‹¤. ë„ë©”ì¸ ê²½ê³„ê°€ ì„ ëª…í• ìˆ˜ë¡ í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ê°€ ë‹¨ë‹¨í•´ì§„ë‹¤.
> ğŸ¤” ì¼ì„ í•˜ë‹¤ ë³´ë©´ ë„ë©”ì¸ ëª¨ë¸ê³¼ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì„œ ë¶„ì‚° ë˜ëŠ” ë¶€ë¶„ë„ ìˆë‹¤. ìµœëŒ€í•œ ë„ë©”ì¸ì•ˆìœ¼ë¡œ ë„£ê¸´ í•˜ê² ì§€ë§Œ ë„ë©”ì¸ì•ˆìœ¼ë¡œ ëª¨ì´ë„ë¡ ì§€í–¥í•´ì•¼ ê² ë‹¤.

---

### 8.5.2 ê³„ì¸µ ìˆ˜ ì¤„ì´ê¸°

* ê°„ì ‘ ê³„ì¸µì„ ëŠ˜ë¦¬ë©´ **ì¶”ë¡  ë‚œì´ë„**ê°€ ê¸‰ê²©íˆ ì˜¬ë¼ê°€ê³ , ì»¨íŠ¸ë¡¤ëŸ¬â†”ë„ë©”ì¸ ì‚¬ì´ì˜ ê²½ê³„ë„ íë ¤ì§„ë‹¤. ê·¸ëŸ¬ë©´ ê° ê³„ì¸µì„ ë”°ë¡œ ê²€ì¦í•˜ë ¤ëŠ” ìœ í˜¹ì´ ì»¤ì§€ê³ , ë¦¬íŒ©í„°ë§ ë‚´ì„±ì´ ë‚®ì•„ì§„ë‹¤. \[p.292â€“294]&#x20;
* ëŒ€ë¶€ë¶„ì˜ ë°±ì—”ë“œì—ì„  **ì„¸ ê³„ì¸µì´ë©´ ì¶©ë¶„**: ë„ë©”ì¸, ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤(ì»¨íŠ¸ë¡¤ëŸ¬), ì¸í”„ë¼. \[p.293]&#x20;

#### í‘œ: ê¶Œì¥ ê³„ì¸µ ìš”ì•½(ê·¸ë¦¼ 8.10 ì¬êµ¬ì„±)

| ê³„ì¸µ               | ì£¼ìš” ì±…ì„             | ë¹„ê³              |
| ---------------- | ----------------- | -------------- |
| ë„ë©”ì¸              | ë¶ˆë³€ì‹, ê·œì¹™, ìƒíƒœ ì „ì´    | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ      |
| ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤(ì»¨íŠ¸ë¡¤ëŸ¬) | ìœ ìŠ¤ì¼€ì´ìŠ¤ ì¡°ì •, íŠ¸ëœì­ì…˜ ê²½ê³„ | í†µí•© í…ŒìŠ¤íŠ¸ ëŒ€ìƒ      |
| ì¸í”„ë¼              | DB, ë©”ì‹œì§€ë²„ìŠ¤, ì™¸ë¶€ API | í…ŒìŠ¤íŠ¸ì—ì„  ëŒ€ê°œ ëª©/í˜ì´í¬ |

> **ë‚´ ìƒê°**: â€œì¶”ìƒ ê³„ì¸µâ€ì€ ë¹šì´ë‹¤. í•„ìš”í•  ë•Œ **ìµœì†Œí•œìœ¼ë¡œ** ë„ì…í•˜ì.
> ğŸ¤” ì¼ë°˜ì ìœ¼ë¡œ ê³„ì¸µì€ 3ê°œê°€ ë§ë‹¤. ê·¼ë° ê°„ì ‘ ê³„ì¸µì´ë¼ëŠ”ê²Œ ë­˜ ì˜ë¯¸í•˜ëŠ”ê±´ì§€ ëª¨ë¥´ê² ë‹¤. ì•ì„œ ì„¤ëª…í•œ í—¥ì‚¬ê³ ë‚ ì€ ì¶”ìƒê³„ì¸µì„ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ëŠ” íŒ¨í„´ì¸ë°.. ìŒ..
---

### 8.5.3 ìˆœí™˜ ì˜ì¡´ì„± ì œê±°í•˜ê¸°

* ìˆœí™˜ ì˜ì¡´ì„±(ì„œë¡œë¥¼ ì§â€§ê°„ì ‘ ì˜ì¡´)ì€ ì½”ë“œë¥¼ ì´í•´í•˜ê¸° ì–´ë µê²Œ í•˜ê³ , ë™ì‘ ë‹¨ìœ„ë¥¼ ê³ ë¦½í•´ í…ŒìŠ¤íŠ¸í•˜ê¸°ë„ ì–´ë µê²Œ ë§Œë“ ë‹¤. \[p.294â€“295]&#x20;
* **ì¸í„°í˜ì´ìŠ¤ë¡œ ê°€ë¦¬ëŠ” ê±´ ì„ì‹œë°©í¸**ì¼ ë¿, ëŸ°íƒ€ì„ ìˆœí™˜ì€ ì—¬ì „í•˜ë‹¤(ê·¸ë¦¼ 8.11). ê·¼ë³¸ í•´ê²°ì€ **í˜¸ì¶œ êµ¬ì¡°ë¥¼ ë°”ê¿”** ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë„ë¡ ë¦¬íŒ©í„°ë§í•˜ëŠ” ê²ƒ. \[p.295â€“296]&#x20;

> **ë‚´ ìƒê°**: â€œì½œë°±ìœ¼ë¡œ ë˜ëŒì•„ì˜¤ê¸°â€ëŠ” íŠ¹íˆ ìœ„í—˜í•˜ë‹¤. ê°€ëŠ¥í•˜ë©´ **ë‹¨ë°©í–¥ íë¦„**ì„ ìœ ì§€í•˜ì.
> ì™„ë²½í•˜ê²Œ ë™ì˜í•œë‹¤. ë¬´ì¡°ê±´ ë‹¨ë°©í–¥ìœ¼ë¡œ íë¥´ë„ë¡ ì„¤ê³„ í•´ì•¼ ëœë‹¤. 

---

### 8.5.4 í…ŒìŠ¤íŠ¸ì—ì„œ ë‹¤ì¤‘ ì‹¤í–‰(when) êµ¬ì ˆ ê¸ˆì§€

* í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ì— ì‹¤í–‰ êµ¬ì ˆì„ ì—¬ëŸ¬ ê°œ ë‘ë©´(**ë“±ë¡ í›„ ì‚­ì œ** ê°™ì€ íë¦„) ê¸ˆë°© **ì´ˆì ì´ íë ¤ì§€ê³  ê±°ëŒ€**í•´ì§„ë‹¤. ìœ ìŠ¤ì¼€ì´ìŠ¤ë³„ë¡œ **í…ŒìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬**í•˜ë¼. \[p.297]&#x20;
* ì˜ˆì™¸ì ìœ¼ë¡œ, ëŠë¦¬ê±°ë‚˜ í˜¸ì¶œ ì œí•œì´ ìˆëŠ” ì™¸ë¶€ ì˜ì¡´ì„±(ìƒŒë“œë°•ìŠ¤ ë“±) ë•Œë¬¸ì— ìƒí˜¸ì‘ìš© íšŸìˆ˜ë¥¼ ì¤„ì—¬ì•¼ í•  ë•Œë§Œ ë‹¤ë‹¨ê³„ í†µí•©/ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸ë¥¼ ê³ ë ¤í•œë‹¤. \[p.297]&#x20;

> **ë‚´ ìƒê°**: ì‹¤í–‰ í•œ ë²ˆ, ê²€ì¦ í•œ ë²ˆ. **ì‘ê³  ì„ ëª…í•œ í…ŒìŠ¤íŠ¸**ê°€ ìœ ì§€ë³´ìˆ˜ì˜ í•µì‹¬ì´ë‹¤.

---

## 8.6 ë¡œê¹… ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•

### 8.6.1 ë¡œê¹…ì„ í…ŒìŠ¤íŠ¸í•´ì•¼ í•˜ëŠ”ê°€?

* ë¡œê¹…ì€ **íš¡ë‹¨ ê´€ì‹¬ì‚¬**ë‹¤. í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì¸ì§€ ì—¬ë¶€ëŠ” â€œ**ì‹ë³„í•  ìˆ˜ ìˆëŠ” ë™ì‘**ì¸ê°€(ì™¸ë¶€ ì´í•´ê´€ê³„ìê°€ ë³¸ë‹¤) vs **êµ¬í˜„ ì„¸ë¶€**ì¸ê°€(ê°œë°œìë§Œ ë³¸ë‹¤)â€ë¡œ ê²°ì •í•˜ì. ì „ìë¼ë©´ í…ŒìŠ¤íŠ¸, í›„ì(ì§„ë‹¨ ë¡œê·¸)ë¼ë©´ í…ŒìŠ¤íŠ¸í•˜ì§€ ì•ŠëŠ”ë‹¤. \[p.299]&#x20;
* í”„ë¦¬ë¨¼/í”„ë¼ì´ìŠ¤ëŠ” ë¡œê¹…ì„ **ì§€ì› ë¡œê¹…**(ìš´ì˜/ì§€ì›ìš©)ê³¼ **ì§„ë‹¨ ë¡œê¹…**(ê°œë°œììš©)ìœ¼ë¡œ êµ¬ë¶„í•œë‹¤. \[p.299â€“300]&#x20;

> **ë‚´ ìƒê°**: â€œëˆ„ê°€ ì´ ë¡œê·¸ë¥¼ ë³´ë‚˜?â€ë¥¼ ë¨¼ì € ë¬»ì. ëŒ€ìƒì´ ë¹„ê°œë°œìë©´ **í…ŒìŠ¤íŠ¸ ëŒ€ìƒ**ì´ë‹¤.

---

### 8.6.2 ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸í• ê¹Œ? (DomainLogger)

* ë¡œê¹…ë„ ê²°êµ­ **í”„ë¡œì„¸ìŠ¤ ì™¸ë¶€ ì˜ì¡´ì„±**(íŒŒì¼/DB)ì´ë¯€ë¡œ ìƒí˜¸ì‘ìš© ê²€ì¦ì—” ëª©ì„ ì“´ë‹¤. ë‹¤ë§Œ **ILogger ìì²´ë¥¼ ëª©**ìœ¼ë¡œ í•˜ì§€ ë§ê³ , \*\*ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ê°€ ë“œëŸ¬ë‚˜ëŠ” ë˜í¼(DomainLogger)\*\*ë¥¼ ë‘ê³  ê·¸ê²ƒê³¼ì˜ ìƒí˜¸ì‘ìš©ì„ ê²€ì¦í•˜ë¼. \[p.300â€“301] &#x20;
* ì´ ë˜í¼ëŠ” **êµ¬ì¡°í™” ë¡œê¹…**ì²˜ëŸ¼ â€œë©”ì‹œì§€ í…œí”Œë¦¿ + íŒŒë¼ë¯¸í„°(ë°ì´í„°)â€ë¥¼ ë¶„ë¦¬í•´ ë‹¤ë£¬ë‹¤. JSON/CSV ë“± **ì—¬ëŸ¬ ë Œë”ë§**ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•˜ë‹¤(ê·¸ë¦¼ 8.12). \[p.302â€“303] &#x20;
* ë‹¨, DomainLoggerë¥¼ **ë„ë©”ì¸ ì—”í„°í‹°ì— ì§ì ‘ ì£¼ì…**í•˜ë©´ ë„ë©”ì¸ì´ ì™¸ë¶€ ì˜ì¡´ì„±ê³¼ ê²°íƒë˜ì–´ ë³µì¡ë„ê°€ ì¦ê°€í•œë‹¤. í•´ê²°ì±…ì€ **ë„ë©”ì¸ ì´ë²¤íŠ¸**ë¡œ ë¶„ë¦¬í•˜ê³ , ì»¨íŠ¸ë¡¤ëŸ¬/ë””ìŠ¤íŒ¨ì²˜ì—ì„œ DomainLoggerë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒ(ì§€ì› ë¡œê¹… í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ë¥¸ ë¹„ê´€ë¦¬ ì˜ì¡´ì„±ê³¼ ë™ì¼í•˜ê²Œ ë‹¤ë£¨ê¸°). \[p.304â€“306]&#x20;

> **ë‚´ ìƒê°**: â€œë¡œê¹…ë„ ë„ë©”ì¸ ì–¸ì–´ë¡œ.â€ í•˜ì§€ë§Œ **ë„ë©”ì¸ ë°–**(ì»¨íŠ¸ë¡¤ëŸ¬/ë””ìŠ¤íŒ¨ì²˜)ì—ì„œ í˜¸ì¶œí•˜ì.

---

### 8.6.3 ë¡œê¹…ì€ ì–¼ë§ˆë‚˜ í•´ì•¼ ì¶©ë¶„í•œê°€?

* **ì§„ë‹¨ ë¡œê·¸ ë‚¨ë°œ ê¸ˆì§€**: ì½”ë“œ(íŠ¹íˆ ë„ë©”ì¸)ë¥¼ í˜¼ë€ìŠ¤ëŸ½ê²Œ í•˜ê³ , **ì‹ í˜¸/ì¡ìŒ ë¹„ìœ¨**ì„ ë‚˜ì˜ê²Œ ë§Œë“ ë‹¤. í•„ìš” ì‹œ **ì¼ì‹œì **ìœ¼ë¡œë§Œ ì“°ê³  ì œê±°í•˜ë¼. ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì˜ˆì™¸ ì¤‘ì‹¬ìœ¼ë¡œ. \[p.307â€“308]&#x20;

> **ë‚´ ìƒê°**: ì§„ë‹¨ ë¡œê·¸ëŠ” â€œê°€ë¡œë“±â€ì´ ì•„ë‹ˆë¼ â€œì†ì „ë“±â€ì´ë‹¤. **í•„ìš”í•  ë•Œë§Œ ì¼°ë‹¤ê°€ ëˆë‹¤.**

---

### 8.6.4 ë¡œê±° ì¸ìŠ¤í„´ìŠ¤ ì „ë‹¬í•˜ê¸°

* ì •ì  ì ‘ê·¼ì/ì •ì  í•„ë“œ(ì•°ë¹„ì–¸íŠ¸ ì»¨í…ìŠ¤íŠ¸)ë¡œ ë¡œê±°ë¥¼ ì–»ëŠ” íŒ¨í„´ì€ **ì•ˆí‹°íŒ¨í„´**: ì˜ì¡´ì„±ì´ ìˆ¨ê³ , í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ì›Œì§€ë©°, ì ì¬ì  ì„¤ê³„ ë¬¸ì œë¥¼ ê°€ë¦°ë‹¤. \[p.307â€“308]&#x20;
* **ëª…ì‹œì  ì£¼ì…**(ë©”ì„œë“œ ì¸ìˆ˜/ìƒì„±ì)ì„ ì‚¬ìš©í•˜ë¼. \[p.308]&#x20;

> **ë‚´ ìƒê°**: â€œí¸í•´ì„œ ì •ì â€ì€ ê¸ˆë¬¼. **ëª…ì‹œì  ì£¼ì…**ì´ ì„¤ê³„ë¥¼ íˆ¬ëª…í•˜ê²Œ í•œë‹¤.

---

## (ì°¸ê³  í‘œ) ê·¸ë¦¼ 8.12 ì¬êµ¬ì„±: êµ¬ì¡°í™” ë¡œê¹…ì˜ ìƒê°ë²•

| ë‹¨ê³„  | ì˜ë¯¸                      | ì˜ˆì‹œ                                                                              |
| --- | ----------------------- | ------------------------------------------------------------------------------- |
| ìº¡ì²˜  | í…œí”Œë¦¿ + íŒŒë¼ë¯¸í„°ë¡œ â€œë°ì´í„°â€ ìˆ˜ì§‘    | `"User {id} changed type from {old} to {new}"` + `(12, "Customer", "Employee")` |
| ë Œë”ë§ | íŒŒì¼/JSON/CSV ë“± ë‹¤ì–‘í•œ ì¶œë ¥ í˜•ì‹ | í‰ë¬¸ ë¡œê·¸ / `{"MessageTemplate":"...","id":12,...}` / `MessageTemplate,id,old,new`  |

\[p.302â€“303] &#x20;

---

# ìƒ˜í”Œ ì½”ë“œ (ë„ë©”ì¸ í¬í•¨, Kotlin)

ì•„ë˜ ì˜ˆì œëŠ” **ê´‘ê³  ë„ë©”ì¸**ì„ ê°€ì •í•©ë‹ˆë‹¤. ìº í˜ì¸ ìƒíƒœ ë³€ê²½ ì‹œ **ì§€ì› ë¡œê¹…**ì„ ë‚¨ê¸´ë‹¤ëŠ” ìš”êµ¬(ë¹„ì¦ˆë‹ˆìŠ¤)ê°€ ìˆê³ , ì´ë¥¼ **as-is(ë„ë©”ì¸ì— ë¡œê±° ì¹¨íˆ¬)** â†’ \*\*to-be(ë„ë©”ì¸ ì´ë²¤íŠ¸ + ë””ìŠ¤íŒ¨ì²˜)\*\*ë¡œ ê°œì„ í•©ë‹ˆë‹¤.

## AS-IS: ë„ë©”ì¸ì— DomainLoggerê°€ ì¹¨íˆ¬í•œ ì„¤ê³„ (ê¶Œì¥ X)

```kotlin
// ë„ë©”ì¸ ìš©ì–´ë¡œ ê°ì‹¼ ì§€ì› ë¡œê¹… ë˜í¼
interface DomainLogger {
    fun campaignStatusChanged(campaignId: Long, old: CampaignStatus, new: CampaignStatus)
}

enum class CampaignStatus { DRAFT, ACTIVE, PAUSED, ENDED }

data class Campaign(
    val id: Long,
    var status: CampaignStatus,
    // âŒ ë„ë©”ì¸ì— ì™¸ë¶€ ì˜ì¡´ì„± ì¹¨íˆ¬
    private val domainLogger: DomainLogger
) {
    fun changeStatus(to: CampaignStatus) {
        if (status == to) return
        val old = status
        status = to
        // ë¹„ì¦ˆë‹ˆìŠ¤(ì§€ì›) ë¡œê·¸
        domainLogger.campaignStatusChanged(id, old, to)
    }
}
```

```kotlin
// AS-IS í†µí•© í…ŒìŠ¤íŠ¸ (ëª©ìœ¼ë¡œ ìƒí˜¸ì‘ìš© í™•ì¸) â€” ê°€ëŠ¥í•˜ì§€ë§Œ ë„ë©”ì¸ ê²°íƒì´ ì‹¬í•¨
class CampaignAsIsTest : io.kotest.core.spec.style.StringSpec({
    "ìƒíƒœ ë³€ê²½ ì‹œ ì§€ì› ë¡œê·¸ê°€ ê¸°ë¡ëœë‹¤(AS-IS)" {
        val calls = mutableListOf<Triple<Long, CampaignStatus, CampaignStatus>>()
        val logger = object : DomainLogger {
            override fun campaignStatusChanged(campaignId: Long, old: CampaignStatus, new: CampaignStatus) {
                calls += Triple(campaignId, old, new)
            }
        }
        val campaign = Campaign(1L, CampaignStatus.DRAFT, logger)

        campaign.changeStatus(CampaignStatus.ACTIVE)

        calls.single() shouldBe Triple(1L, CampaignStatus.DRAFT, CampaignStatus.ACTIVE)
    }
})
```

> **ë¬¸ì œì (ì±… 8.6.2 ì§€ì ê³¼ ë™ì¼)**: ë„ë©”ì¸ì´ ì™¸ë¶€ ì˜ì¡´ì„±ê³¼ ê²°íƒë˜ì–´ ë³µì¡í•´ì§€ê³  í…ŒìŠ¤íŠ¸/ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›Œì§„ë‹¤. â†’ **ë„ë©”ì¸ ì´ë²¤íŠ¸ë¡œ ë¶„ë¦¬**í•˜ì.&#x20;

---

## TO-BE: ë„ë©”ì¸ ì´ë²¤íŠ¸ + ë””ìŠ¤íŒ¨ì²˜(ì»¨íŠ¸ë¡¤ëŸ¬/ì„œë¹„ìŠ¤ì—ì„œ ì§€ì› ë¡œê¹…)

```kotlin
// 1) ë„ë©”ì¸ ì´ë²¤íŠ¸ ì •ì˜ (ë„ë©”ì¸ ìˆœìˆ˜ ìœ ì§€)
interface DomainEvent
data class CampaignStatusChangedEvent(
    val campaignId: Long,
    val old: CampaignStatus,
    val new: CampaignStatus
) : DomainEvent

// 2) ë„ë©”ì¸ ì—”í„°í‹° (ì™¸ë¶€ ì˜ì¡´ì„± X)
data class Campaign(
    val id: Long,
    var status: CampaignStatus,
    val domainEvents: MutableList<DomainEvent> = mutableListOf()
) {
    fun changeStatus(to: CampaignStatus) {
        if (status == to) return
        val old = status
        status = to
        domainEvents += CampaignStatusChangedEvent(id, old, to) // ë„ë©”ì¸ ì´ë²¤íŠ¸ ì ì¬
    }
}

// 3) ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ: ì´ë²¤íŠ¸ ë””ìŠ¤íŒ¨ì²˜ê°€ DomainLoggerë¥¼ í˜¸ì¶œ
class EventDispatcher(private val domainLogger: DomainLogger) {
    fun dispatch(events: List<DomainEvent>) {
        events.forEach {
            when (it) {
                is CampaignStatusChangedEvent -> domainLogger.campaignStatusChanged(it.campaignId, it.old, it.new)
                // ë‹¤ë¥¸ ì´ë²¤íŠ¸ ë§¤í•‘...
            }
        }
    }
}

// 4) ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤(ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• )
class CampaignService(
    private val repo: CampaignRepository,
    private val dispatcher: EventDispatcher
) {
    fun activate(id: Long) {
        val c = repo.findById(id) ?: throw IllegalArgumentException("not found")
        c.changeStatus(CampaignStatus.ACTIVE)
        repo.save(c)
        dispatcher.dispatch(c.domainEvents) // âœ… ì§€ì› ë¡œê¹…ì€ ì—¬ê¸°ì„œ
        c.domainEvents.clear()
    }
}

// ì¸í”„ë¼/ì €ì¥ì†Œ í¬íŠ¸
interface CampaignRepository {
    fun findById(id: Long): Campaign?
    fun save(campaign: Campaign)
}
class InMemoryCampaignRepository : CampaignRepository {
    private val store = mutableMapOf<Long, Campaign>()
    override fun findById(id: Long) = store[id]
    override fun save(campaign: Campaign) { store[campaign.id] = campaign }
}
```

```kotlin
// TO-BE: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ â€” ë„ë©”ì¸ì€ ì´ë²¤íŠ¸ë§Œ ë°©ì¶œí•˜ë©´ ëœë‹¤
class CampaignToBeUnitTest : io.kotest.core.spec.style.StringSpec({
    "ë„ë©”ì¸ì€ ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸ë§Œ ë°©ì¶œí•œë‹¤" {
        val campaign = Campaign(1L, CampaignStatus.DRAFT)

        campaign.changeStatus(CampaignStatus.ACTIVE)

        campaign.domainEvents.single() shouldBe CampaignStatusChangedEvent(
            1L, CampaignStatus.DRAFT, CampaignStatus.ACTIVE
        )
    }
})
```

```kotlin
// TO-BE: í†µí•© í…ŒìŠ¤íŠ¸ â€” ì»¨íŠ¸ë¡¤ëŸ¬(ì„œë¹„ìŠ¤)ì™€ DomainLogger ìƒí˜¸ì‘ìš© ê²€ì¦
class CampaignToBeIntegrationTest : io.kotest.core.spec.style.StringSpec({
    "ì„œë¹„ìŠ¤ëŠ” ì´ë²¤íŠ¸ë¥¼ DomainLogger í˜¸ì¶œë¡œ ë³€í™˜í•œë‹¤(ì§€ì› ë¡œê¹… í…ŒìŠ¤íŠ¸)" {
        val repo = InMemoryCampaignRepository().apply { save(Campaign(1L, CampaignStatus.DRAFT)) }
        val calls = mutableListOf<Triple<Long, CampaignStatus, CampaignStatus>>()
        val logger = object : DomainLogger {
            override fun campaignStatusChanged(campaignId: Long, old: CampaignStatus, new: CampaignStatus) {
                calls += Triple(campaignId, old, new)
            }
        }
        val service = CampaignService(repo, EventDispatcher(logger))

        service.activate(1L)

        calls.single() shouldBe Triple(1L, CampaignStatus.DRAFT, CampaignStatus.ACTIVE)
        repo.findById(1L)!!.status shouldBe CampaignStatus.ACTIVE
    }
})
```

> ì´ êµ¬ì¡°ëŠ” ì±…ì˜ â€œë„ë©”ì¸ ì´ë²¤íŠ¸â†’ì»¨íŠ¸ë¡¤ëŸ¬/ë””ìŠ¤íŒ¨ì²˜ì—ì„œ ì™¸ë¶€ ì˜ì¡´ì„± í˜¸ì¶œâ€ ê¶Œê³ ì™€ ë™ì¼í•˜ë‹¤. \[p.304â€“306]&#x20;

---

# ìš”ì•½

* **8.5 ëª¨ë²” ì‚¬ë¡€**: (1) ë„ë©”ì¸ ê²½ê³„ ëª…ì‹œ, (2) ê³„ì¸µ ìµœì†Œí™”(ë„ë©”ì¸/ì• í”Œë¦¬ì¼€ì´ì…˜/ì¸í”„ë¼ 3ê³„ì¸µ), (3) ìˆœí™˜ ì˜ì¡´ì„± ì œê±°, (4) í…ŒìŠ¤íŠ¸ì—ì„œ ë‹¤ì¤‘ ì‹¤í–‰ êµ¬ì ˆ ì§€ì–‘. \[p.291â€“297]   &#x20;
* **8.6 ë¡œê¹… í…ŒìŠ¤íŠ¸**: â€œëˆ„ê°€ ë³´ë‚˜?â€ë¡œ ê²°ì •í•œë‹¤. **ì§€ì› ë¡œê¹…**ì€ í…ŒìŠ¤íŠ¸, **ì§„ë‹¨ ë¡œê¹…**ì€ ì¼ë°˜ì ìœ¼ë¡œ ë¹„í…ŒìŠ¤íŠ¸. ILoggerë¥¼ ì§ì ‘ ëª©í‚¹í•˜ì§€ ë§ê³  **DomainLogger** ê°™ì€ ë˜í¼ë¥¼ ì“°ë˜, ë„ë©”ì¸ì— ì£¼ì…í•˜ì§€ ë§ê³  **ë„ë©”ì¸ ì´ë²¤íŠ¸ + ë””ìŠ¤íŒ¨ì²˜**ë¡œ ì™¸ë¶€ ì˜ì¡´ì„±ê³¼ ë¶„ë¦¬í•˜ë¼. **ê³¼ë„í•œ ì§„ë‹¨ ë¡œê·¸ ê¸ˆì§€**, ë¡œê±°ëŠ” **ëª…ì‹œì  ì£¼ì…**. \[p.299â€“308]   &#x20;

---

## ì¶”ê°€ ìë£Œ(ìš”ì  ì •ë¦¬ + ë§í¬)

* **ì§€ì› vs ì§„ë‹¨ ë¡œê¹…**: ìš´ì˜ìê°€ ì¶”ì í•  ë©”ì‹œì§€(ì§€ì›)ì™€ ê°œë°œì ë””ë²„ê¹…(ì§„ë‹¨)ì„ êµ¬ë¶„í•´ ì„¤ê³„Â·í…ŒìŠ¤íŠ¸ ë²”ìœ„ë¥¼ ì •í•˜ë¼. ([principal-it.eu][1])
* **êµ¬ì¡°í™” ë¡œê¹…(Serilog)**: ë©”ì‹œì§€ í…œí”Œë¦¿ê³¼ ì†ì„± ë°ì´í„°ë¥¼ ë¶„ë¦¬í•´ì„œ ìº¡ì²˜í•˜ê³ , ì´í›„ JSON/CSV ë“± ë‹¤ì–‘í•œ ë Œë”ë§ìœ¼ë¡œ ë¶„ì„ì„±ì„ ë†’ì¸ë‹¤. í…œí”Œë¦¿ ì†ì„± ì‚¬ìš© ê¶Œì¥. ([serilog.net][2], [GitHub][3], [Medium][4])
* **ë„ë©”ì¸ ì§€í–¥ ê°€ì‹œì„±(Observability)**: ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì ì˜ ì‹ í˜¸ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ìˆ˜ì§‘Â·ë¶„ì„í•˜ì(ì´ë²¤íŠ¸/ë¡œê¹…ë¥¼ ë„ë©”ì¸ ì–¸ì–´ë¡œ). ([martinfowler.com][5])
* **ì•°ë¹„ì–¸íŠ¸ ì»¨í…ìŠ¤íŠ¸ ì•ˆí‹°íŒ¨í„´**: ì •ì  ì ‘ê·¼ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ìˆ¨ê¸°ë©´ ë³€ê²½Â·í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ì›Œì§„ë‹¤. ëª…ì‹œì  ì£¼ì…ìœ¼ë¡œ ì „í™˜. ([Manning Publications][6], [Stack Overflow][7])

---

## ë‚´ ìƒê° (ì§§ê²Œ)

* 8.5: **í…ŒìŠ¤íŠ¸ ì¹œí™”ì  ì„¤ê³„ = ë‹¨ìˆœí•œ ì˜ì¡´ ê·¸ë˜í”„**. ê²½ê³„ë¥¼ ì„¸ìš°ê³ , ì¸µì„ ì¤„ì´ê³ , ìˆœí™˜ì„ ëŠì.
* 8.6: **ë¡œê¹…ë„ ë„ë©”ì¸ ì–¸ì–´ë¡œ**. ë‹¤ë§Œ ë„ë©”ì¸ì€ ìˆœìˆ˜í•˜ê²Œ ë‘ê³ , **ì´ë²¤íŠ¸â†’ë””ìŠ¤íŒ¨ì²˜**ì—ì„œ ì™¸ë¶€ ì„¸ê³„(ë¡œê·¸ ì €ì¥ì†Œ)ë¥¼ ë§Œë‚˜ë¼.

---

## ì¶œì²˜

* ë³¸ë¬¸ ì¸ìš©: ã€ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(8ì¥)ã€, 8.5â€“8.6 ì •ë¦¬. \[p.291â€“309]

  * ë„ë©”ì¸ ê²½ê³„/ê³„ì¸µ/ìˆœí™˜:  &#x20;
  * ë‹¤ì¤‘ ì‹¤í–‰ êµ¬ì ˆ ê¸ˆì§€:&#x20;
  * ë¡œê¹…ì˜ í…ŒìŠ¤íŠ¸ ì—¬ë¶€/ë°©ë²•/êµ¬ì¡°í™”/ì´ë²¤íŠ¸/ì£¼ì…:   &#x20;
* ì¶”ê°€ ìë£Œ: Serilog, DI/ì•°ë¹„ì–¸íŠ¸ ì»¨í…ìŠ¤íŠ¸, ë„ë©”ì¸ ê´€ì  ë¡œê¹… ë“±(ìƒë‹¨ ë§í¬ ì°¸ì¡°). ([serilog.net][2], [GitHub][3], [Medium][4], [Manning Publications][6], [martinfowler.com][5])

---

[1]: https://principal-it.eu/2020/11/unit-tests-for-logging/?utm_source=chatgpt.com "How To Write Unit Tests For Logging - Principal IT"
[2]: https://serilog.net/?utm_source=chatgpt.com "Serilog â€” simple .NET logging with fully-structured events"
[3]: https://github.com/serilog/serilog/wiki/Writing-Log-Events?utm_source=chatgpt.com "Writing Log Events Â· serilog/serilog Wiki"
[4]: https://medium.com/c-sharp-programming/serilog-advanced-formatting-from-templates-to-readable-logs-dea47402138a?utm_source=chatgpt.com "Serilog: Advanced Formatting: From Templates to ..."
[5]: https://martinfowler.com/articles/domain-oriented-observability.html?utm_source=chatgpt.com "Domain-Oriented Observability"
[6]: https://www.manning.com/books/dependency-injection-principles-practices-patterns?utm_source=chatgpt.com "Dependency Injection Principles, Practices, and Patterns"
[7]: https://stackoverflow.com/questions/66664096/is-static-domain-helper-class-ambient-context-anti-pattern?utm_source=chatgpt.com "Is \"static Domain helper class\" Ambient Context Anti-Pattern?"
