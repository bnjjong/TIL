# 7ì¥ ê°€ì¹˜ ìˆëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¦¬íŒ©í„°ë§
## 7.1 ë¦¬íŒ©í„°ë§í•  ì½”ë“œ ì‹ë³„í•˜ê¸° 
### 7.1.1 ì½”ë“œì˜ ë„¤ ê°€ì§€ ìœ í˜• 
ê°€ì¹˜ ìˆëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” ë¨¼ì € ì½”ë“œë¥¼ ë„¤ ê°€ì§€ ìœ í˜•ìœ¼ë¡œ ë¶„ë¥˜í•˜ì—¬ ì–´ë–¤ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•´ì•¼ í•˜ëŠ”ì§€ ì‹ë³„í•´ì•¼ í•©ë‹ˆë‹¤. ëª¨ë“  ì œí’ˆ ì½”ë“œëŠ” ë‘ ì°¨ì›ìœ¼ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:[1][2][3]

**1. ë³µì¡ë„ ë˜ëŠ” ë„ë©”ì¸ ìœ ì˜ì„± (Complexity or Domain Significance)**
- **ì½”ë“œ ë³µì¡ë„(Code Complexity)**: ì½”ë“œ ë‚´ ì˜ì‚¬ ê²°ì •(ë¶„ê¸°) ì§€ì  ìˆ˜ë¡œ ì •ì˜í•©ë‹ˆë‹¤. ìˆœí™˜ ë³µì¡ë„ëŠ” `1 + `ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.[2][1]
- **ë„ë©”ì¸ ìœ ì˜ì„±(Domain Significance)**: ì½”ë“œê°€ í”„ë¡œì íŠ¸ì˜ ë¬¸ì œ ë„ë©”ì¸ì— ëŒ€í•´ ì–¼ë§ˆë‚˜ ì˜ë¯¸ ìˆëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë„ë©”ì¸ ê³„ì¸µì˜ ëª¨ë“  ì½”ë“œëŠ” ìµœì¢… ì‚¬ìš©ìì˜ ëª©í‘œì™€ ì§ì ‘ì ì¸ ì—°ê´€ì„±ì´ ìˆì–´ ë„ë©”ì¸ ìœ ì˜ì„±ì´ ë†’ìŠµë‹ˆë‹¤.[4][1]

**2. í˜‘ë ¥ì ìˆ˜ (Number of Collaborators)**
- í˜‘ë ¥ìëŠ” ê°€ë³€ ì˜ì¡´ì„±ì´ê±°ë‚˜ í”„ë¡œì„¸ìŠ¤ ì™¸ë¶€ ì˜ì¡´ì„±(ë˜ëŠ” ë‘˜ ë‹¤)ì…ë‹ˆë‹¤.
- í˜‘ë ¥ìê°€ ë§ì„ìˆ˜ë¡ í…ŒìŠ¤íŠ¸ ë¹„ìš©ì´ ë§ì´ ë“¤ê³ , í…ŒìŠ¤íŠ¸ í¬ê¸°ê°€ ì»¤ì ¸ ìœ ì§€ ë³´ìˆ˜ì„±ì´ ë–¨ì–´ì§‘ë‹ˆë‹¤. [3][1]
    > ğŸ¤” í˜‘ë ¥ìê°€ ë§ë‹¤ëŠ”ê±´ ê·¸ë§Œí¼ ë¡œì§ì´ ë³µì¡í•˜ê±°ë‚˜, ì• ì´ˆì— ì˜ ëª¨ë“ˆí™”í•˜ì—¬ aggregation í•´ì„œ ì‚¬ìš©í•œë‹¤ëŠ” ì˜ë¯¸ë„ ë ìˆ˜ ìˆì„ ê²ƒ ê°™ì€ë°.. ì¼ë¶€ ë¡œì§ì—ì„œëŠ” í”¼í• ìˆ˜ ì—†ì„ìˆ˜ë„ ìˆê² ë‹¤.

**ë„¤ ê°€ì§€ ì½”ë“œ ìœ í˜•:**
![alt text](./images/2501-7.1-ë‹¨ìœ„í…ŒìŠ¤íŠ¸-ê°€ì¹˜ìˆëŠ”í…ŒìŠ¤íŠ¸ë¥¼ìœ„í•œë¦¬íŒ©í„°ë§-ì½”ë“œë„¤ê°€ì§€ìœ í˜•ê³¼í—˜ë¸”ê°ì²´íŒ¨í„´-P.png)




**ë„¤ ê°€ì§€ ì½”ë“œ ìœ í˜•:**
**1. ë„ë©”ì¸ ëª¨ë¸ê³¼ ì•Œê³ ë¦¬ì¦˜ (Domain Model and Algorithms)**
- ë³µì¡ë„/ë„ë©”ì¸ ìœ ì˜ì„±: ë†’ìŒ, í˜‘ë ¥ì ìˆ˜: ì ìŒ
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì—ì„œ ê°€ì¥ ì´ë¡œìš´ ì½”ë“œ**ì…ë‹ˆë‹¤. ë³µì¡í•˜ê±°ë‚˜ ì¤‘ìš”í•œ ë¡œì§ì„ ìˆ˜í–‰í•´ì„œ íšŒê·€ ë°©ì§€ê°€ í–¥ìƒë˜ê³ , í˜‘ë ¥ìê°€ ì ì–´ì„œ í…ŒìŠ¤íŠ¸ ìœ ì§€ë¹„ê°€ ë‚®ìŠµë‹ˆë‹¤.[1][2][3]
    > ğŸ¤” ì•„ë§ˆë„ pure functionìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ìˆê³  ë„ë©”ì¸ ëª¨ë¸ì˜ ê²½ìš° ë…ë¦½ì ìœ¼ë¡œ ì„¤ê³„ê°€ ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ì´ ì„ í–‰ ì¡°ê±´ë“¤ì´ ì§€ì¼œì§„ë‹¤ë©´ ìœ„ì˜ ì„¤ëª…ì´ ìœ íš¨í• ê±° ê°™ë‹¤.

**2. ê°„ë‹¨í•œ ì½”ë“œ (Trivial Code)**
- ë³µì¡ë„/ë„ë©”ì¸ ìœ ì˜ì„±: ë‚®ìŒ, í˜‘ë ¥ì ìˆ˜: ì ìŒ
- ë§¤ê°œë³€ìˆ˜ê°€ ì—†ëŠ” ìƒì„±ì, í•œ ì¤„ ì†ì„± ë“±ì´ í•´ë‹¹ë©ë‹ˆë‹¤. **í…ŒìŠ¤íŠ¸í•  í•„ìš”ê°€ ì „í˜€ ì—†ìŠµë‹ˆë‹¤**.[5][3]

**3. ì»¨íŠ¸ë¡¤ëŸ¬ (Controllers)**
- ë³µì¡ë„/ë„ë©”ì¸ ìœ ì˜ì„±: ë‚®ìŒ, í˜‘ë ¥ì ìˆ˜: ë§ìŒ
- ë³µì¡í•œ ì‘ì—…ì„ í•˜ì§€ ì•Šê³  ë„ë©”ì¸ í´ë˜ìŠ¤ì™€ ì™¸ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‘ì—…ì„ ì¡°ì •í•©ë‹ˆë‹¤. **í¬ê´„ì ì¸ í†µí•© í…ŒìŠ¤íŠ¸ì˜ ì¼ë¶€ë¡œ ê°„ë‹¨íˆ í…ŒìŠ¤íŠ¸**í•´ì•¼ í•©ë‹ˆë‹¤.[3][5][1]

**4. ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•œ ì½”ë“œ (Overcomplicated Code)**
- ë³µì¡ë„/ë„ë©”ì¸ ìœ ì˜ì„±: ë†’ìŒ, í˜‘ë ¥ì ìˆ˜: ë§ìŒ
- **ê°€ì¥ ë¬¸ì œê°€ ë˜ëŠ” ì½”ë“œ ìœ í˜•**ì…ë‹ˆë‹¤. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ì–´ë µì§€ë§Œ **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì—†ì´ ë‘ëŠ” ê²ƒì€ ìœ„í—˜**í•©ë‹ˆë‹¤. **ì•Œê³ ë¦¬ì¦˜ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë¶„í• **í•´ì•¼ í•©ë‹ˆë‹¤.[5][1][3]

### 7.1.2 í—˜ë¸” ê°ì²´ íŒ¨í„´ì„ ì‚¬ìš©í•´ ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•œ ì½”ë“œ ë¶„í• í•˜ê¸° 
**í—˜ë¸” ê°ì²´ íŒ¨í„´(Humble Object Pattern)**ì€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ìš´ í–‰ìœ„ì™€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ í–‰ìœ„ë¥¼ ë¶„ë¦¬í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì…ë‹ˆë‹¤.[6][7][8]

![alt text](./images/2501-7.1-ë‹¨ìœ„í…ŒìŠ¤íŠ¸-ê°€ì¹˜ìˆëŠ”í…ŒìŠ¤íŠ¸ë¥¼ìœ„í•œë¦¬íŒ©í„°ë§-ì½”ë“œë„¤ê°€ì§€ìœ í˜•ê³¼í—˜ë¸”ê°ì²´íŒ¨í„´-P-2.png)

í•µì‹¬ ì•„ì´ë””ì–´:
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ë¶€ë¶„ì„ ì¶”ì¶œí•˜ì—¬ ë³„ë„ì˜ êµ¬ì„± ìš”ì†Œë¡œ ë§Œë“­ë‹ˆë‹¤
- í—˜ë¸” ë˜í¼(Humble Wrapper)ëŠ” í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ìš´ ì˜ì¡´ì„±ê³¼ ìƒˆë¡œ ì¶”ì¶œëœ êµ¬ì„± ìš”ì†Œë¥¼ ì—°ê²°í•˜ì§€ë§Œ, ìì²´ì ì¸ ë¡œì§ì´ ê±°ì˜ ì—†ì–´ì„œ í…ŒìŠ¤íŠ¸í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤[9][6][3]

ì´ íŒ¨í„´ì€ ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP)ì„ ë”°ë¥´ë©°, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ê³¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.[3][5]


## Kotlin ì˜ˆì œ ì½”ë“œ
### As-Is: ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•œ ì½”ë“œ ì˜ˆì œ
```kotlin
// ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•œ ì½”ë“œ ì˜ˆì œ - ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ
class OrderProcessor(
    private val orderRepository: OrderRepository,
    private val paymentGateway: PaymentGateway,
    private val emailService: EmailService,
    private val inventoryService: InventoryService
) {
    // ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë§ì€ í˜‘ë ¥ìê°€ ì„ì—¬ìˆëŠ” ë¬¸ì œì  ì½”ë“œ
    fun processOrder(orderRequest: OrderRequest): OrderResult {
        // ì£¼ë¬¸ ìœ íš¨ì„± ê²€ì¦ (ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
        if (orderRequest.items.isEmpty()) {
            return OrderResult.failure("ì£¼ë¬¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤")
        }
        
        // í• ì¸ ê³„ì‚° (ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
        val totalAmount = calculateTotalWithDiscounts(orderRequest)
        if (totalAmount <= 0) {
            return OrderResult.failure("ì˜ëª»ëœ ì£¼ë¬¸ ê¸ˆì•¡ì…ë‹ˆë‹¤")
        }
        
        try {
            // ì¬ê³  í™•ì¸ (ì™¸ë¶€ ì˜ì¡´ì„±)
            val availabilityResult = inventoryService.checkAvailability(orderRequest.items)
            if (!availabilityResult.isAvailable) {
                return OrderResult.failure("ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤: ${availabilityResult.unavailableItems}")
            }
            
            // ê²°ì œ ì²˜ë¦¬ (ì™¸ë¶€ ì˜ì¡´ì„±)
            val paymentResult = paymentGateway.processPayment(
                amount = totalAmount,
                cardInfo = orderRequest.paymentInfo
            )
            
            if (!paymentResult.isSuccess) {
                return OrderResult.failure("ê²°ì œ ì‹¤íŒ¨: ${paymentResult.errorMessage}")
            }
            
            // ì£¼ë¬¸ ì €ì¥ (ì™¸ë¶€ ì˜ì¡´ì„±)
            val order = Order(
                id = generateOrderId(),
                customerId = orderRequest.customerId,
                items = orderRequest.items,
                totalAmount = totalAmount,
                status = OrderStatus.CONFIRMED,
                paymentId = paymentResult.transactionId
            )
            
            val savedOrder = orderRepository.save(order)
            
            // ì¬ê³  ì°¨ê° (ì™¸ë¶€ ì˜ì¡´ì„±)
            inventoryService.reserveItems(orderRequest.items)
            
            // ì´ë©”ì¼ ë°œì†¡ (ì™¸ë¶€ ì˜ì¡´ì„±)
            emailService.sendOrderConfirmation(
                to = orderRequest.customerEmail,
                orderDetails = savedOrder
            )
            
            return OrderResult.success(savedOrder)
            
        } catch (exception: Exception) {
            return OrderResult.failure("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${exception.message}")
        }
    }
    
    // ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    private fun calculateTotalWithDiscounts(orderRequest: OrderRequest): BigDecimal {
        val baseTotal = orderRequest.items.sumOf { it.price * it.quantity }
        
        var discountRate = BigDecimal.ZERO
        
        // ìˆ˜ëŸ‰ í• ì¸
        if (orderRequest.items.sumOf { it.quantity } >= 10) {
            discountRate += BigDecimal("0.05") // 5% í• ì¸
        }
        
        // VIP ê³ ê° í• ì¸
        if (orderRequest.customerType == CustomerType.VIP) {
            discountRate += BigDecimal("0.10") // 10% í• ì¸
        }
        
        // ì‹œì¦Œ í• ì¸
        if (isHolidaySeason()) {
            discountRate += BigDecimal("0.15") // 15% í• ì¸
        }
        
        // ìµœëŒ€ í• ì¸ìœ¨ ì œí•œ
        discountRate = discountRate.min(BigDecimal("0.25")) // ìµœëŒ€ 25%
        
        return baseTotal * (BigDecimal.ONE - discountRate)
    }
    
    private fun isHolidaySeason(): Boolean {
        val now = LocalDate.now()
        return (now.monthValue == 12 && now.dayOfMonth >= 20) || 
               (now.monthValue == 1 && now.dayOfMonth <= 7)
    }
    
    private fun generateOrderId(): String = UUID.randomUUID().toString()
}

// ì§€ì› í´ë˜ìŠ¤ë“¤
data class OrderRequest(
    val customerId: String,
    val customerEmail: String,
    val customerType: CustomerType,
    val items: List<OrderItem>,
    val paymentInfo: PaymentInfo
)

data class OrderItem(
    val productId: String,
    val name: String,
    val price: BigDecimal,
    val quantity: Int
)

enum class CustomerType { REGULAR, VIP }
enum class OrderStatus { PENDING, CONFIRMED, SHIPPED, DELIVERED, CANCELLED }

// í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë ¤ìš´ ë³µì¡í•œ ì½”ë“œ
class OrderProcessorTest : StringSpec({
    "ì£¼ë¬¸ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸" {
        // ë§ì€ Mock ì„¤ì •ì´ í•„ìš”í•˜ê³  ë³µì¡í•¨
        val orderRepository = mockk<OrderRepository>()
        val paymentGateway = mockk<PaymentGateway>()
        val emailService = mockk<EmailService>()
        val inventoryService = mockk<InventoryService>()
        
        every { inventoryService.checkAvailability(any()) } returns AvailabilityResult(true, emptyList())
        every { paymentGateway.processPayment(any(), any()) } returns PaymentResult(true, "tx123", null)
        every { orderRepository.save(any()) } returns mockk<Order>()
        every { inventoryService.reserveItems(any()) } just Runs
        every { emailService.sendOrderConfirmation(any(), any()) } just Runs
        
        val processor = OrderProcessor(orderRepository, paymentGateway, emailService, inventoryService)
        
        val request = OrderRequest(
            customerId = "customer1",
            customerEmail = "test@example.com",
            customerType = CustomerType.VIP,
            items = listOf(OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 2)),
            paymentInfo = PaymentInfo("1234-5678-9012-3456")
        )
        
        val result = processor.processOrder(request)
        
        result.isSuccess shouldBe true
    }
})

```

### To-Be: í—˜ë¸” ê°ì²´ íŒ¨í„´ ì ìš© í›„

```kotlin
// 1. ë„ë©”ì¸ ëª¨ë¸ê³¼ ì•Œê³ ë¦¬ì¦˜ (í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ ìˆœìˆ˜í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
class OrderCalculator {
    
    // ë³µì¡í•œ í• ì¸ ê³„ì‚° ë¡œì§ - ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ
    fun calculateTotalWithDiscounts(
        items: List<OrderItem>,
        customerType: CustomerType,
        orderDate: LocalDate = LocalDate.now()
    ): BigDecimal {
        val baseTotal = items.sumOf { it.price * it.quantity }
        val discountRate = calculateDiscountRate(items, customerType, orderDate)
        return baseTotal * (BigDecimal.ONE - discountRate)
    }
    
    private fun calculateDiscountRate(
        items: List<OrderItem>,
        customerType: CustomerType,
        orderDate: LocalDate
    ): BigDecimal {
        var discountRate = BigDecimal.ZERO
        
        // ìˆ˜ëŸ‰ í• ì¸
        if (items.sumOf { it.quantity } >= 10) {
            discountRate += BigDecimal("0.05") // 5% í• ì¸
        }
        
        // VIP ê³ ê° í• ì¸
        if (customerType == CustomerType.VIP) {
            discountRate += BigDecimal("0.10") // 10% í• ì¸
        }
        
        // ì‹œì¦Œ í• ì¸
        if (isHolidaySeason(orderDate)) {
            discountRate += BigDecimal("0.15") // 15% í• ì¸
        }
        
        // ìµœëŒ€ í• ì¸ìœ¨ ì œí•œ
        return discountRate.min(BigDecimal("0.25")) // ìµœëŒ€ 25%
    }
    
    private fun isHolidaySeason(date: LocalDate): Boolean {
        return (date.monthValue == 12 && date.dayOfMonth >= 20) || 
               (date.monthValue == 1 && date.dayOfMonth <= 7)
    }
}

// ì£¼ë¬¸ ë„ë©”ì¸ ëª¨ë¸ - ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ ë‹´ê³  ìˆëŠ” ìˆœìˆ˜í•œ ê°ì²´
class Order private constructor(
    val id: String,
    val customerId: String,
    val items: List<OrderItem>,
    val totalAmount: BigDecimal,
    private var _status: OrderStatus,
    val paymentId: String? = null,
    val createdAt: LocalDateTime = LocalDateTime.now()
) {
    val status: OrderStatus get() = _status
    
    companion object {
        fun create(
            customerId: String,
            items: List<OrderItem>,
            totalAmount: BigDecimal,
            paymentId: String? = null
        ): Order {
            require(items.isNotEmpty()) { "ì£¼ë¬¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤" }
            require(totalAmount > BigDecimal.ZERO) { "ì£¼ë¬¸ ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤" }
            
            return Order(
                id = UUID.randomUUID().toString(),
                customerId = customerId,
                items = items,
                totalAmount = totalAmount,
                _status = OrderStatus.CONFIRMED,
                paymentId = paymentId
            )
        }
    }
    
    // ë„ë©”ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    fun cancel(): Order {
        require(_status == OrderStatus.CONFIRMED) { "í™•ì •ëœ ì£¼ë¬¸ë§Œ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" }
        return copy(status = OrderStatus.CANCELLED)
    }
    
    fun ship(): Order {
        require(_status == OrderStatus.CONFIRMED) { "í™•ì •ëœ ì£¼ë¬¸ë§Œ ë°°ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" }
        return copy(status = OrderStatus.SHIPPED)
    }
    
    private fun copy(
        id: String = this.id,
        customerId: String = this.customerId,
        items: List<OrderItem> = this.items,
        totalAmount: BigDecimal = this.totalAmount,
        status: OrderStatus = this._status,
        paymentId: String? = this.paymentId,
        createdAt: LocalDateTime = this.createdAt
    ): Order {
        return Order(id, customerId, items, totalAmount, status, paymentId, createdAt).also {
            it._status = status
        }
    }
}

// 2. ì»¨íŠ¸ë¡¤ëŸ¬ (í—˜ë¸” ê°ì²´ - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ë§Œ ë‹´ë‹¹)
class OrderProcessingService(
    private val orderRepository: OrderRepository,
    private val paymentGateway: PaymentGateway,
    private val emailService: EmailService,
    private val inventoryService: InventoryService,
    private val orderCalculator: OrderCalculator = OrderCalculator()
) {
    
    // ë‹¨ìˆœí•œ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë¡œì§ - ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ë„ë©”ì¸ìœ¼ë¡œ ìœ„ì„
    suspend fun processOrder(orderRequest: OrderRequest): OrderResult {
        return try {
            // 1. ì´ì•¡ ê³„ì‚° (ë„ë©”ì¸ ë¡œì§ìœ¼ë¡œ ìœ„ì„)
            val totalAmount = orderCalculator.calculateTotalWithDiscounts(
                items = orderRequest.items,
                customerType = orderRequest.customerType
            )
            
            // 2. ì¬ê³  í™•ì¸
            val availabilityResult = inventoryService.checkAvailability(orderRequest.items)
            if (!availabilityResult.isAvailable) {
                return OrderResult.failure("ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤: ${availabilityResult.unavailableItems}")
            }
            
            // 3. ê²°ì œ ì²˜ë¦¬
            val paymentResult = paymentGateway.processPayment(totalAmount, orderRequest.paymentInfo)
            if (!paymentResult.isSuccess) {
                return OrderResult.failure("ê²°ì œ ì‹¤íŒ¨: ${paymentResult.errorMessage}")
            }
            
            // 4. ì£¼ë¬¸ ìƒì„± (ë„ë©”ì¸ ë¡œì§ìœ¼ë¡œ ìœ„ì„)
            val order = Order.create(
                customerId = orderRequest.customerId,
                items = orderRequest.items,
                totalAmount = totalAmount,
                paymentId = paymentResult.transactionId
            )
            
            // 5. ì£¼ë¬¸ ì €ì¥
            val savedOrder = orderRepository.save(order)
            
            // 6. ì¬ê³  ì°¨ê°
            inventoryService.reserveItems(orderRequest.items)
            
            // 7. ì´ë©”ì¼ ë°œì†¡
            emailService.sendOrderConfirmation(orderRequest.customerEmail, savedOrder)
            
            OrderResult.success(savedOrder)
            
        } catch (exception: Exception) {
            OrderResult.failure("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${exception.message}")
        }
    }
}

// ê²°ê³¼ í´ë˜ìŠ¤
sealed class OrderResult {
    data class Success(val order: Order) : OrderResult()
    data class Failure(val message: String) : OrderResult()
    
    val isSuccess: Boolean get() = this is Success
    val isFailure: Boolean get() = this is Failure
    
    companion object {
        fun success(order: Order): OrderResult = Success(order)
        fun failure(message: String): OrderResult = Failure(message)
    }
}

// ì§€ì› í´ë˜ìŠ¤ë“¤
data class PaymentInfo(val cardNumber: String)
data class PaymentResult(val isSuccess: Boolean, val transactionId: String?, val errorMessage: String?)
data class AvailabilityResult(val isAvailable: Boolean, val unavailableItems: List<String>)

// ì™¸ë¶€ ì˜ì¡´ì„± ì¸í„°í˜ì´ìŠ¤ë“¤
interface OrderRepository {
    fun save(order: Order): Order
}

interface PaymentGateway {
    suspend fun processPayment(amount: BigDecimal, paymentInfo: PaymentInfo): PaymentResult
}

interface EmailService {
    suspend fun sendOrderConfirmation(email: String, order: Order)
}

interface InventoryService {
    suspend fun checkAvailability(items: List<OrderItem>): AvailabilityResult
    suspend fun reserveItems(items: List<OrderItem>)
}

```

### í…ŒìŠ¤íŠ¸ ì½”ë“œ (Kotest)
```kotlin
// ë„ë©”ì¸ ë¡œì§ í…ŒìŠ¤íŠ¸ - ì™¸ë¶€ ì˜ì¡´ì„± ì—†ì´ ì‰½ê²Œ í…ŒìŠ¤íŠ¸
class OrderCalculatorTest : StringSpec({
    
    val calculator = OrderCalculator()
    
    "ì¼ë°˜ ê³ ê° ê¸°ë³¸ ì£¼ë¬¸ ê³„ì‚°" {
        val items = listOf(
            OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 1),
            OrderItem("product2", "ìƒí’ˆ2", BigDecimal("20000"), 1)
        )
        
        val total = calculator.calculateTotalWithDiscounts(
            items = items,
            customerType = CustomerType.REGULAR,
            orderDate = LocalDate.of(2024, 6, 15) // ë¹„ì‹œì¦Œ
        )
        
        total shouldBe BigDecimal("30000") // í• ì¸ ì—†ìŒ
    }
    
    "VIP ê³ ê° ëŒ€ëŸ‰ ì£¼ë¬¸ ì‹œì¦Œ í• ì¸ ì ìš©" {
        val items = listOf(
            OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 10) // ìˆ˜ëŸ‰ í• ì¸ ëŒ€ìƒ
        )
        
        val total = calculator.calculateTotalWithDiscounts(
            items = items,
            customerType = CustomerType.VIP, // VIP í• ì¸
            orderDate = LocalDate.of(2024, 12, 25) // ì‹œì¦Œ í• ì¸
        )
        
        // ê¸°ë³¸ ê¸ˆì•¡: 100,000ì›
        // ìˆ˜ëŸ‰ í• ì¸: 5%, VIP í• ì¸: 10%, ì‹œì¦Œ í• ì¸: 15%
        // ì´ í• ì¸ìœ¨: 25% (ìµœëŒ€ê°’ ì ìš©)
        // ìµœì¢… ê¸ˆì•¡: 75,000ì›
        total shouldBe BigDecimal("75000")
    }
    
    "ìµœëŒ€ í• ì¸ìœ¨ ì œí•œ í™•ì¸" {
        val items = listOf(
            OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 15) // ìˆ˜ëŸ‰ í• ì¸
        )
        
        val total = calculator.calculateTotalWithDiscounts(
            items = items,
            customerType = CustomerType.VIP, // VIP í• ì¸  
            orderDate = LocalDate.of(2024, 12, 25) // ì‹œì¦Œ í• ì¸
        )
        
        // ëª¨ë“  í• ì¸ì„ ì ìš©í•´ë„ 25%ë¥¼ ì´ˆê³¼í•˜ì§€ ì•ŠìŒ
        total shouldBe BigDecimal("112500") // 25% í• ì¸ ì ìš©
    }
})

// ë„ë©”ì¸ ëª¨ë¸ í…ŒìŠ¤íŠ¸
class OrderTest : StringSpec({
    
    "ìœ íš¨í•œ ì£¼ë¬¸ ìƒì„±" {
        val items = listOf(
            OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 2)
        )
        
        val order = Order.create(
            customerId = "customer1",
            items = items,
            totalAmount = BigDecimal("20000")
        )
        
        order.customerId shouldBe "customer1"
        order.items shouldBe items
        order.totalAmount shouldBe BigDecimal("20000")
        order.status shouldBe OrderStatus.CONFIRMED
    }
    
    "ë¹ˆ ì£¼ë¬¸ í•­ëª©ìœ¼ë¡œ ì£¼ë¬¸ ìƒì„± ì‹œ ì˜ˆì™¸ ë°œìƒ" {
        shouldThrow<IllegalArgumentException> {
            Order.create(
                customerId = "customer1",
                items = emptyList(),
                totalAmount = BigDecimal("0")
            )
        }.message shouldBe "ì£¼ë¬¸ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤"
    }
    
    "0 ì´í•˜ ê¸ˆì•¡ìœ¼ë¡œ ì£¼ë¬¸ ìƒì„± ì‹œ ì˜ˆì™¸ ë°œìƒ" {
        val items = listOf(
            OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 1)
        )
        
        shouldThrow<IllegalArgumentException> {
            Order.create(
                customerId = "customer1", 
                items = items,
                totalAmount = BigDecimal.ZERO
            )
        }.message shouldBe "ì£¼ë¬¸ ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤"
    }
    
    "í™•ì •ëœ ì£¼ë¬¸ ì·¨ì†Œ" {
        val order = Order.create(
            customerId = "customer1",
            items = listOf(OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 1)),
            totalAmount = BigDecimal("10000")
        )
        
        val cancelledOrder = order.cancel()
        
        cancelledOrder.status shouldBe OrderStatus.CANCELLED
        order.status shouldBe OrderStatus.CONFIRMED // ì›ë³¸ì€ ë³€ê²½ë˜ì§€ ì•ŠìŒ
    }
})

// ì„œë¹„ìŠ¤ í†µí•© í…ŒìŠ¤íŠ¸ (Mock ì‚¬ìš©)
class OrderProcessingServiceTest : StringSpec({
    
    "ì„±ê³µì ì¸ ì£¼ë¬¸ ì²˜ë¦¬" {
        val orderRepository = mockk<OrderRepository>()
        val paymentGateway = mockk<PaymentGateway>()
        val emailService = mockk<EmailService>()
        val inventoryService = mockk<InventoryService>()
        
        // Mock ì„¤ì •
        coEvery { inventoryService.checkAvailability(any()) } returns AvailabilityResult(true, emptyList())
        coEvery { paymentGateway.processPayment(any(), any()) } returns PaymentResult(true, "tx123", null)
        every { orderRepository.save(any()) } returnsArgument 0
        coEvery { inventoryService.reserveItems(any()) } just Runs
        coEvery { emailService.sendOrderConfirmation(any(), any()) } just Runs
        
        val service = OrderProcessingService(orderRepository, paymentGateway, emailService, inventoryService)
        
        val request = OrderRequest(
            customerId = "customer1",
            customerEmail = "test@example.com",
            customerType = CustomerType.REGULAR,
            items = listOf(OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 2)),
            paymentInfo = PaymentInfo("1234-5678-9012-3456")
        )
        
        val result = service.processOrder(request)
        
        result.isSuccess shouldBe true
        coVerify { inventoryService.checkAvailability(request.items) }
        coVerify { paymentGateway.processPayment(BigDecimal("20000"), request.paymentInfo) }
        verify { orderRepository.save(any()) }
        coVerify { inventoryService.reserveItems(request.items) }
        coVerify { emailService.sendOrderConfirmation(request.customerEmail, any()) }
    }
    
    "ì¬ê³  ë¶€ì¡± ì‹œ ì£¼ë¬¸ ì‹¤íŒ¨" {
        val inventoryService = mockk<InventoryService>()
        val service = OrderProcessingService(
            orderRepository = mockk(),
            paymentGateway = mockk(), 
            emailService = mockk(),
            inventoryService = inventoryService
        )
        
        coEvery { inventoryService.checkAvailability(any()) } returns 
            AvailabilityResult(false, listOf("product1"))
        
        val request = OrderRequest(
            customerId = "customer1",
            customerEmail = "test@example.com", 
            customerType = CustomerType.REGULAR,
            items = listOf(OrderItem("product1", "ìƒí’ˆ1", BigDecimal("10000"), 2)),
            paymentInfo = PaymentInfo("1234-5678-9012-3456")
        )
        
        val result = service.processOrder(request)
        
        result.isFailure shouldBe true
        (result as OrderResult.Failure).message shouldContain "ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤"
    }
})

```

## ìš”ì•½**7ì¥ ê°€ì¹˜ ìˆëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¦¬íŒ©í„°ë§**ì˜ í•µì‹¬ ë‚´ìš©:

### ì½”ë“œì˜ ë„¤ ê°€ì§€ ìœ í˜•
| ìœ í˜• | ë³µì¡ë„/ë„ë©”ì¸ ìœ ì˜ì„± | í˜‘ë ¥ì ìˆ˜ | í…ŒìŠ¤íŠ¸ ì „ëµ |
|------|---------------------|-----------|-------------|
| ë„ë©”ì¸ ëª¨ë¸ê³¼ ì•Œê³ ë¦¬ì¦˜ | ë†’ìŒ | ì ìŒ | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì§‘ì¤‘ |
| ê°„ë‹¨í•œ ì½”ë“œ | ë‚®ìŒ | ì ìŒ | í…ŒìŠ¤íŠ¸ ë¶ˆí•„ìš” |
| ì»¨íŠ¸ë¡¤ëŸ¬ | ë‚®ìŒ | ë§ìŒ | í†µí•© í…ŒìŠ¤íŠ¸ |
| ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•œ ì½”ë“œ | ë†’ìŒ | ë§ìŒ | ë¶„í•  í›„ í…ŒìŠ¤íŠ¸ |

### í—˜ë¸” ê°ì²´ íŒ¨í„´ì˜ ì´ì [6][3][9]
- **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë¶„ë¦¬**: ë³µì¡í•œ ë„ë©”ì¸ ë¡œì§ì„ ìˆœìˆ˜í•œ í•¨ìˆ˜ë¡œ ì¶”ì¶œ
- **í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í–¥ìƒ**: ì™¸ë¶€ ì˜ì¡´ì„± ì—†ëŠ” ë„ë©”ì¸ ë¡œì§ì€ ì‰½ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ **: ê´€ì‹¬ì‚¬ ë¶„ë¦¬ë¡œ ì½”ë“œ ë³€ê²½ ì‹œ ì˜í–¥ ë²”ìœ„ ìµœì†Œí™”
- **ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜**: ê° í´ë˜ìŠ¤ê°€ í•˜ë‚˜ì˜ ëª…í™•í•œ ì±…ì„ë§Œ ê°€ì§

### ì‹¤ë¬´ ì ìš© ê°€ì´ë“œë¼ì¸[1][2][3]
1. **ì½”ë“œê°€ ë” ì¤‘ìš”í•˜ê±°ë‚˜ ë³µì¡í• ìˆ˜ë¡ í˜‘ë ¥ìëŠ” ë” ì ì–´ì•¼ í•©ë‹ˆë‹¤**
2. **ë„ë©”ì¸ ëª¨ë¸ì€ í”„ë¡œì„¸ìŠ¤ ì™¸ë¶€ ì˜ì¡´ì„±ì„ ì‚¬ìš©í•˜ë©´ ì•ˆ ë©ë‹ˆë‹¤**
3. **ì§€ë‚˜ì¹˜ê²Œ ë³µì¡í•œ ì½”ë“œë¥¼ í”¼í•˜ê³  ë„ë©”ì¸ ëª¨ë¸ê³¼ ì•Œê³ ë¦¬ì¦˜ë§Œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ ê°€ì¹˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸ë¡œ ê°€ëŠ” ê¸¸ì…ë‹ˆë‹¤**

## ê´€ë ¨ ë§í¬
- [7ì¥ ê°€ì¹˜ ìˆëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¦¬íŒ©í„°ë§ - ë¦¬íŒ©í„°ë§í•  ì½”ë“œ ì‹ë³„í•˜ê¸°](https://jonghoonpark.com/2023/07/18/identifying-the-code-to-refactor)[1]
- [í—˜ë¸” ê°ì²´ íŒ¨í„´ - Clean Architecture](https://share-factory.tistory.com/34)[6]
- [í…ŒìŠ¤íŠ¸ëŠ” ì–´ë–»ê²Œ ì¢‹ì€ ì½”ë“œë¥¼ ë§Œë“œëŠ”ê°€(feat. í—˜ë¸” ê°ì²´ íŒ¨í„´)](https://d2.naver.com/helloworld/9921217)[9]


[1] https://jonghoonpark.com/2023/07/18/identifying-the-code-to-refactor
[2] https://velog.io/@crow/%EA%B0%80%EC%B9%98%EC%9E%88%EB%8A%94-%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%9C-%EB%A6%AC%ED%8C%A9%ED%84%B0%EB%A7%81
[3] https://baby-care-dev.tistory.com/6
[4] https://www.kimcoder.io/books/unit-testing/7
[5] https://dionysus2074.tistory.com/313
[6] https://share-factory.tistory.com/34
[7] https://dheldh77.tistory.com/entry/Clean-Architecture-%EC%A0%95%EB%A6%AC-23%EC%9E%A5-%ED%94%84%EB%A0%88%EC%A0%A0%ED%84%B0%EC%99%80-%ED%97%98%EB%B8%94-%EA%B0%9D%EC%B2%B4
[8] https://forum.dotnetdev.kr/t/steven-giesel/6258
[9] https://d2.naver.com/helloworld/9921217
[10] https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/32004849/9ddb5b7a-e639-4ea4-8016-e90ca3760cf0/2501-danwi-teseuteu-pages-221-230.pdf
[11] https://healthcoding.tistory.com/44
[12] https://devforme.tistory.com/39
[13] https://narakit.tistory.com/292
[14] https://namhoon.kim/2022/12/13/method-test/033/index.html
[15] https://dev-playground.oopy.io/0248cf20-79cb-4491-a14c-1b600e23e963
[16] https://reimaginer.tistory.com/entry/%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%97%90-%EB%8C%80%ED%95%9C-%EC%8B%A4%EC%9A%A9%EC%A0%81%EC%9D%B8-%EC%A0%91%EA%B7%BC-Humble-Object-Pattern
[17] https://dev-playground.oopy.io/6966add4-1e7c-427f-bf6f-cf980420dc5c
[18] https://feel2.tistory.com/37
[19] https://jonghoonpark.com/2023/10/26/%ED%94%84%EB%A0%88%EC%A0%A0%ED%84%B0%EC%99%80-%ED%97%98%EB%B8%94-%EA%B0%9D%EC%B2%B4
[20] https://jonghoonpark.com/2023/07/28/refactoring-toward-valuable-unit-tests
[21] https://ojt90902.tistory.com/1359
[22] https://cloud.google.com/looker/docs/scatter-options?hl=ko
[23] https://dev.to/krofdrakula/make-testable-components-using-the-humble-object-pattern-1j4o
[24] https://dev-coco.tistory.com/190
[25] https://stackoverflow.com/questions/5324049/what-is-the-humble-object-pattern-and-when-is-it-useful
[26] https://umbum.dev/1206/
[27] https://kotlinlang.org/docs/object-declarations.html
[28] https://www.inflearn.com/community/questions/915012/controller-application-service-domain-%EC%9D%98-%EC%97%AD%ED%95%A0-%EA%B5%AC%EB%B6%84
[29] https://asana.com/ko/resources/eisenhower-matrix
[30] https://www.codingblocks.net/podcast/clean-architecture-what-is-the-humble-object-pattern/
[31] https://parkmuhyeun.github.io/etc/java/2023-12-16-Domain/
[32] https://dev.to/marcellogalhardo/humble-views-proud-viewmodels-od1
[33] https://velog.io/@seoyong-lee/MVC-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EC%95%8C%EA%B8%B0
[34] https://www.goe.go.kr/resource/old/BBSMSTR_000000030179/BBS_202501161038123800.pdf
[35] https://blog.baudson.de/blog/tactical-design-by-example-using-kotlin-and-spring-boot-part-2
[36] https://umbum.tistory.com/1066
[37] https://scienceon.kisti.re.kr/srch/selectPORSrchArticle.do?cn=JAKO201925462478636
[38] https://blog.baudson.de/blog/tactical-design-by-example-using-kotlin-and-spring-boot-part-12-using-kotlin-delegates-for-domain-events