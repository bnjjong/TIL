클라우드 인프라의 **근본적인 문제점**을 파헤치고, 기존 빅데이터 솔루션들이 클라우드 환경에서 왜 비효율적이고 비싼지를 명확히 설명합니다. 이 글은 온프레미스 환경에 맞춰 설계된 시스템을 클라우드로 '리프트 앤 시프트'하는 방식의 **한계와 숨겨진 비용**을 지적하며, 진정한 클라우드 네이티브 인프라의 필요성을 강조합니다. 특히, apache kafka와 같은 핵심 시스템을 **클라우드 환경에 최적화**하여 비용을 획기적으로 절감하고 운영 복잡성을 줄이는 warpstream의 접근 방식을 통해, 독자들은 **차세대 클라우드 인프라 설계 원칙**과 실질적인 비용 절감 방안에 대한 깊은 통찰을 얻을 수 있습니다.

## 1. 클라우드 인프라의 근본적인 문제점: 빅데이터 인프라의 기원과 진화

## 1.1. 빅데이터 인프라의 기원과 초기 문제점

1. **빅데이터 인프라 프로젝트의 탄생 배경**:
    1. Cassandra, Kafka, Hadoop 등 오늘날 널리 사용되는 오픈소스 빅데이터 인프라 프로젝트들은 대기업이 기존 도구로 해결하기 어려운 고유한 대규모 인프라 문제를 해결하기 위해 내부 솔루션을 개발한 후 오픈소스로 공개하면서 시작되었다.  
    2. 이를 통해 소규모 스타트업도 숙련된 엔지니어링 팀의 작업과 전문 지식의 혜택을 받을 수 있을 것으로 기대되었다.  
2. **오픈소스 빅데이터 시스템 도입의 어려움**:
    1. 거의 10년이 지난 후, 많은 개발자는 오픈소스 빅데이터 시스템 도입이 예상과 달리 시간 절약이나 효율성 증대로 이어지지 않았다고 평가한다.  
    2. 빅테크 기업들이 코드는 오픈소스화했지만, 해당 시스템을 운영하고 확장하는 데 필요한 전문 지식이나 도구는 함께 공개하지 않았기 때문이다.  
    3. 이는 설계된 환경과 다른 조건에서 소프트웨어를 채택할 때 발생하는 문제로, 소프트웨어 자체의 결함이라기보다는 사용 환경의 부적합성에서 기인한다.  
3. **Uber와 Apple의 Cassandra 사례**:
    1. 필자는 Uber 재직 당시 Cassandra 문제로 어려움을 겪었으나, Apple에서 온 스토리지 디렉터는 Apple에서는 Uber보다 100배 많은 Cassandra 노드를 운영했음에도 문제가 없었다고 언급했다.  
    2. 수년 후, 필자는 Apple의 Cassandra 팀 엔지니어와의 대화를 통해 Apple이 Uber가 사용하던 오픈소스 Cassandra와 거의 유사성이 없는 **커스텀 빌드 Cassandra**를 운영하고 있었음을 깨달았다.  
    3. Apple은 커스텀 플러그인, 모듈, 도구, 오케스트레이션 등을 통해 사실상 완전히 다른 데이터베이스를 운영하고 있었던 것이다.  

## 1.2. 빅데이터 인프라 시장의 3단계 진화와 사용자 손실

1. **시장 진화의 배경**: 빅데이터 인프라 프로젝트의 채택이 증가하면서, 이 인프라를 둘러싼 상업적 기회가 막대하다는 것이 명확해졌다.  
2. **1단계: 도구, 자동화, 지원 판매 (Phase 1: selling tooling, automation, and support)** 
    1. **접근 방식**: 초기 인프라 기업들은 오픈소스 인프라 소프트웨어 운영의 어려움을 해결하기 위해 도구, 자동화, 지원 서비스를 판매했다.  
    2. **문제점**: 이러한 상업화는 오픈소스 자체에 부정적인 영향을 미쳤다.  
        1. 오픈소스 개발이 저해되는 경우가 많았는데, 이는 벤더들이 프로젝트의 주요 후원자이면서도 좋은 도구를 독점했기 때문이다.  
        2. 동시에 이들 인프라 기업들은 소프트웨어의 사용 난이도를 통해 상당한 수익을 창출하기 시작했다.  
    3. **결과**: 벤더들은 오픈소스 개선 시 수익이 줄어드는 **모순적인 인센티브**에 직면하게 되었고, 이는 마치 질병을 만들고 그 치료법을 판매하여 이익을 얻는 것과 같은 상황을 초래했다.  
3. **2단계: 인프라 및 관리형 서비스 판매 (Phase 2: selling infrastructure and managed services)** 
    1. **접근 방식**: 도구와 지원 개선만으로는 문제 해결에 한계가 있었고, 클라우드 채택이 증가함에 따라 벤더들은 인프라를 "서비스형(as a service)"으로 제공하기 시작했다.  
    2. **기대 효과**:
        1. 사용자는 대규모 인프라 운영의 복잡성에서 벗어나고, 벤더는 소프트웨어 실행 환경을 더 잘 제어할 수 있게 된다.  
        2. 사용자 경험이 크게 향상되고, 벤더는 규모의 경제를 통해 비용을 절감할 수 있을 것으로 기대되었다.  
        3. 인프라 서비스는 더 쉽고 저렴할 것으로 예상되었다.  
    3. **실제 결과**:
        1. 현실에서는 이러한 기대가 실현되지 않았다. 많은 초기 사용자들은 비용 절감을 약속받았지만, 실제로는 자체 호스팅 솔루션보다 5~10배 비용이 증가하는 것을 경험했다.  
        2. 이는 **온프레미스 데이터 센터용으로 설계된 소프트웨어를 클라우드로 "리프트 앤 시프트(lift and shift)"하는 방식**이 어떤 규모에서든 비효율적인 단위 경제를 초래하기 때문이다.  
        3. 벤더에게 문제를 추상화하도록 비용을 지불하는 것은 문제를 더욱 악화시킬 뿐이다.  
    4. **클라우드 인프라의 원죄**:
        1. 이것이 바로 **클라우드 인프라의 원죄**이다.  
        2. 인프라 기업들은 새로운 시장을 선점하기 위해 서두르면서, 클라우드 기본 요소를 **실제로 활용하도록 소프트웨어를 재설계하지 않았다.** 
        3. 심지어 재설계를 원하더라도, 그렇게 하면 자신들이 구축한 비즈니스 모델을 서서히 파괴하게 되므로 재설계할 수 없는 상황이다.  
        4. 이러한 원죄로 인해 기업들은 운영하기 너무 어려운 인프라와 비용이 너무 비싼 벤더 사이에서 딜레마에 빠지게 되었다.  
        5. 이러한 새로운 수익화 전략은 벤더가 오픈소스 인프라 기술의 효율성을 더욱 저해할 유인을 증가시켰다.  
    5. **Apache Kafka 사례**:
        1. Apache Kafka는 이 문제의 대표적인 사례이다.  
        2. Kafka의 아키텍처는 설계된 데이터 센터 환경에서는 합리적이었지만, 복제 방식 때문에 클라우드 환경에서는 **엄청나게 비싸고 운영하기 어렵다.** 
        3. 클라우드에서 Kafka를 통해 1GiB의 데이터를 전송하는 비용은 최적화된 Kafka 클러스터에서도 S3에 2개월 동안 1GiB의 데이터를 저장하는 비용보다 더 많이 든다.  
        4. 프로듀서와 컨슈머를 위한 클라우드 계정과 벤더의 클라우드 계정 간의 네트워크 인그레스 및 이그레스 수수료는 이 문제를 더욱 심화시킨다.  
4. **3단계: "리프트 앤 시프트" BYOC (Phase 3: "lift and shift" BYOC)** 
    1. **접근 방식**: 최근 벤더들은 BYOC(Bring Your Own Cloud) 배포라는 세 번째 접근 방식을 제시했다.  
    2. **개념**: 소프트웨어 스택을 데이터 플레인과 컨트롤 플레인 두 가지 구성 요소로 분리하여, 데이터 플레인은 고객의 클라우드 계정에서, 컨트롤 플레인은 벤더의 클라우드 계정에서 실행하는 방식이다.  
    3. **기대 효과**: 이론적으로는 자체 호스팅의 낮은 비용과 완전 관리형 SaaS의 낮은 오버헤드를 모두 제공하여, 양쪽의 장점을 모두 취할 수 있을 것으로 기대되었다.  
    4. **Kafka에 대한 매력**: Apache Kafka는 본질적으로 네트워크 사용량이 많기 때문에, 모든 네트워킹을 고객의 클라우드 계정 내에 유지하면 모든 관련자에게 막대한 비용 절감 효과를 가져올 수 있어 특히 매력적인 접근 방식이다.  
    5. **실제 문제점**: 기존 BYOC 제품들은 두 가지 이유로 실제로는 잘 작동하지 않는다.  
        1. **진정한 데이터 플레인/컨트롤 플레인 분리 실패**: 벤더들은 소프트웨어를 실제로 재설계하여 진정한 데이터 플레인/컨트롤 플레인 분리를 만들지 않았다.  
        2. 대신, 벤더의 클라우드 계정과 고객의 클라우드 계정 사이에 큰 구멍을 뚫고, 거대한 컨테이너와 커스텀 컨트롤러를 특별한 Kubernetes 클러스터에 배포한 다음, 숙련된 엔지니어 팀을 고용하여 이 모든 인프라를 원격으로 관리한다.  
        3. 이 방식은 한동안 작동하지만, 궁극적으로 벤더에게 단위 경제가 지속 가능하지 않아 이 비즈니스 모델은 유효 기간이 있다.  
        4. **내부 클라우드 계정 비용 문제 미해결**: 기존 BYOC Kafka 솔루션은 고객 클라우드 계정과 벤더 클라우드 계정 간의 네트워킹 수수료는 제거하지만, 고객 클라우드 계정 **내부에서 발생하는 영역 간 네트워킹 및 스토리지 수수료**는 해결하지 못한다.  
        5. 이러한 비용은 클라우드를 위해 모든 소프트웨어를 **첫 번째 원칙부터 재설계**해야만 해결할 수 있다.  
    6. **결론**: 잘못된 BYOC는 온프레미스용 소프트웨어를 클라우드 환경에 억지로 끼워 넣으려는 새로운 시도일 뿐이다.  
        1. 단지 온프레미스 소프트웨어를 벤더의 클라우드 계정 대신 고객의 클라우드 계정으로 리프트 앤 시프트하려는 차이만 있을 뿐, 핵심을 놓치고 있다.  

## 2. 클라우드에 최적화된 인프라의 필요성 및 WarpStream의 접근 방식

## 2.1. 클라우드에 목적 지향적으로 구축된 인프라의 필요성

1. **기존 인프라의 딜레마**: 오랫동안 소프트웨어 산업은 핵심 인프라에 대해 어려운 상황에 처해 있었다.  
    1. 기업들은 오픈소스 인프라 소프트웨어를 대규모로 유지하기 위해 팀을 훈련하고 커스텀 도구를 개발하는 데 수년을 보내거나, 벤더에게 비용을 지불하다 파산해야 했다.  
    2. 그 결과, Apache Kafka와 같은 시스템은 압도적인 비즈니스 가치를 제공할 수 있을 때만 사용되었다.  
    3. 이러한 상황은 변화해야 한다.  
2. **새로운 인프라의 요구사항**:
    1. 클라우드를 위해 처음부터 설계되고, 실제 "일반" 기업의 사용 사례를 염두에 둔 핵심 인프라를 구축하는 기업들이 필요하다.  
    2. 비즈니스를 지원하는 시스템은 **탄력적이고, 투명하며, 관리가 용이**해야 한다.  
    3. 클라우드를 나중에 고려하는 것이 아니라, **클라우드를 위해 생성**되어야 하며, 필요에 맞게 설계되지 않은 오픈소스 데이터 인프라를 맹목적으로 채택하는 방식은 재고되어야 한다.  
    4. 이를 "목적 지향적 인프라(purpose built infrastructure)"라고 부를 수 있으며, 이는 특정 사용 사례에 맞춰 개조된 인프라가 아니라, 실제 사용 사례를 위해 목적을 가지고 설계된 인프라를 의미한다.  
3. **"제대로 된 BYOC"의 약속**:
    1. 이것이 바로 **"제대로 된 BYOC"**의 약속이며, 인프라가 클라우드를 위해 **진정으로 설계**되었을 때 얼마나 훌륭한 결과를 가져올 수 있는지를 보여준다.  
    2. 벤더가 고객의 클라우드 계정에서 소프트웨어를 실행하려면, 그 소프트웨어는 **관리가 극도로 쉬워야 한다.** 
    3. 이는 "완전히 무상태(stateless)이며 망가뜨리기 거의 불가능한", "소프트웨어를 실행하는 전체 Kubernetes 클러스터를 실수로 삭제해도 데이터가 손실되지 않는", "스케일 인/아웃이 컨테이너 추가 또는 제거를 의미하는" 수준의 용이성을 의미한다.  
    4. 데이터 센터에서 실행된다고 생각하는 매우 상태 저장 소프트웨어를 관리하기 위해 정교한 Kubernetes 오퍼레이터를 작성하는 것을 의미하지 않는다.  
    5. 즉, 모든 BYOC 구현이 동일하게 만들어지는 것은 아니다.  

## 2.2. WarpStream: 클라우드 네이티브, BYOC-First 인프라

1. **WarpStream의 탄생 배경**:
    1. WarpStream은 이러한 요구사항을 충족하는 새로운 인프라 프로젝트 중 하나이다.  
    2. Uber의 M3DB와 Datadog의 Husky와 같은 시스템을 구축한 경험을 바탕으로, WarpStream은 클라우드를 위해 목적 지향적으로 설계되었으며, 기존 팀들이 익숙한 경험보다 훨씬 향상된 경험을 제공한다.  
    3. WarpStream은 데이터 스트리밍의 안정적인 대규모 처리가 어려운 점을 통해 수익을 창출하지만, 고객들은 지불하는 비용에 대한 실제 이점을 얻을 수 있다.  
    4. WarpStream은 단순히 작동할 뿐만 아니라, **Apache Kafka를 자체 호스팅하는 것보다 저렴하며**, 규모에 관계없이 단일 엔지니어가 배포하고 유지 관리할 수 있다.  
2. **WarpStream의 설계 원칙**:
    1. WarpStream 설계 시, 스트리밍 시장을 진정으로 혁신하려면 자체 호스팅 Apache Kafka와 경쟁해야 한다는 점을 인지했다.  
    2. 이러한 관찰은 두 가지 필연적인 설계 선택으로 이어졌다.  
        1. **클라우드 단위 경제 중심 설계**: WarpStream은 클라우드 단위 경제를 중심으로 처음부터 설계되어야 했다.  
        2. WarpStream 운영의 총 소유 비용은 컨트롤 플레인/라이선스 비용을 고려하더라도 자체 호스팅 Apache Kafka보다 저렴해야 했다.  
        3. **BYOC-First 접근 방식**: WarpStream은 BYOC-First여야 했다.  
        4. Kafka와 같은 "빅데이터" 및 네트워크 사용량이 많은 미션 크리티컬 인프라에는 다른 모델이 합리적이지 않다.  
3. **WarpStream의 혁신적인 아키텍처**:
    1. WarpStream은 Apache Kafka를 포크하여 클라우드로 리프트 앤 시프트하는 대신, 모든 설계 결정을 첫 번째 원칙부터 평가하여 현대 클라우드 환경이 제공하는 모든 것을 활용하는 완전히 새로운 구현을 만들었다.  
    2. **주요 설계 특징**:
        1. **객체 스토리지를 유일한 스토리지로 사용**: WarpStream은 객체 스토리지를 시스템의 **주요이자 유일한 스토리지**로 사용한다.  
        2. 그 결과, 스택의 어느 곳에도 로컬 디스크가 없다.  
        3. 이는 모든 WarpStream 사용자가 Kafka의 복제 및 내구성 보장에 대한 전문가가 될 필요 없이, 이 문제를 AWS S3 팀에 위임할 수 있음을 의미한다.  
        4. 데이터는 객체 스토리지에 기록되고 적절히 복제되어 사용 가능하거나, 그렇지 않거나 둘 중 하나이다. 중간은 없다.  
        5. **영역 간 데이터 복제 없음**: WarpStream은 가용성 영역 간에 데이터를 수동으로 복제하지 않는다.  
        6. 이는 이전에 논의된 영역 간 네트워킹 수수료를 제거하며, WarpStream이 자체 호스팅과 비교해서도 Kafka 비용을 4~10배 절감할 수 있는 주된 이유이다.  
        7. **데이터 플레인과 컨트롤 플레인의 엄격한 분리**: WarpStream은 데이터 플레인과 컨트롤 플레인 사이에 극도로 엄격한 분리를 가지고 있다.  
        8. 이는 고객의 클라우드 계정과 WarpStream 클라우드 간의 네트워크 트래픽 양을 최소화하여 비용을 절감하고, 개인 정보 보호 및 데이터 주권을 보장한다.  
        9. 이러한 분리를 통해 WarpStream은 까다로운 컨트롤 플레인, 메타데이터, 합의 로직의 대부분을 WarpStream 클라우드 계정으로 이동시키면서 전체 데이터 플레인을 고객의 클라우드 계정에 유지함으로써 고객 환경 내에서 "관리형 SaaS" 경험을 제공할 수 있다.  
    3. **결론**: 모든 WarpStream 설계 결정은 클라우드 네이티브 및 BYOC-First 시스템을 만들기 위해 첫 번째 원칙부터 평가되었으며, 이는 기존의 다른 어떤 아키텍처와도 근본적으로 다른 아키텍처로 이어졌다.  

## 2.3. WarpStream의 시장 반응 및 향후 비전

1. **개발자 프리뷰 반응**: WarpStream의 개발자 프리뷰를 처음 발표했을 때, 그 반응에 완전히 놀랐다.  
    1. 수년간 Apache Kafka의 비용과 운영 부담으로 어려움을 겪어온 다양한 규모의 기업들로부터 WarpStream 사용을 간절히 기다린다는 메시지를 받았다.  
    2. 그 이후로 WarpStream은 초기 사용자 및 디자인 파트너와 긴밀히 협력하여 가장 비용 효율적이고 운영하기 쉬운 Kafka 구현이자 가장 강력하고 잘 테스트된 구현으로 만들었다.  
2. **"Kafka 구현"이라는 용어의 의도**:
    1. "Kafka 구현"이라는 문구를 매우 의도적으로 사용한다.  
    2. 과거에는 Postgres와 Kafka가 단 하나의 구현만을 가진 시스템을 지칭했지만, 오늘날에는 동일한 프로토콜을 구현하는 많은 경쟁 시스템들이 존재한다.  
    3. 이는 긍정적인 변화이다. 모두가 피하고 싶은 것은 100개의 새로운 벤더가 100개의 새로운 인프라를 각각 상호 운용성이나 호환성 없이 제공하는 상황이다.  
    4. 데이터 스트리밍과 같은 주요 사용 사례에 표준 프로토콜이 있고, 벤더들이 구현을 놓고 경쟁하는 미래에서 사용자들이 승리할 것이다.  
    5. 사용자들은 몇 달간의 노력 없이도 벤더를 전환할 수 있어야 하며, 이러한 인센티브는 모두가 가장 원하는, 즉 모두를 위한 최상의 인프라로 이어질 것이다.  
3. **WarpStream BYOC GA 출시 및 투자 유치**:
    1. 이러한 비전을 바탕으로, WarpStream BYOC가 이제 GA(General Availability)로 출시되었다.  
    2. 또한, 클라우드 네이티브, BYOC-First 인프라에 대한 비전을 실현하기 위해 Amplify Partners와 Greylock Partners로부터 2천만 달러를 유치했다.