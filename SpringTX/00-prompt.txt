Spring Transactional 공부를 하고 싶은데 어떻게 공부를 해야될지 목차를 너가 만들어 줄래? 스터디 기간은 데일리로 1시간 정도 매일 할 예정임
---

나는 기본적으로 Spring을 이용해서 10여년 개발을 해본 프로그래머임. 주로 kotlin과 java를 이용해서 서버개발을 함.

오늘은 12일차 학습이야.
주제는 능·모니터링·장애 대응
세부 내용은
- 슬로우 쿼리 모니터링
- 트랜잭션 로그·AOP 포인트컷 분석
꼭 세부내용에 국한될 필요는 없을것 같아. 추가로 더 학습해야될 내용이 있다면 너가 제안해주고 알려줘.
해당 내용의 정의와 개념 그리고 해당 기능이나 학습해야될 내용에 대한 배경지식도 알려줘.
필요하면 내부 구현 코드도 공부를 해보고 싶어.
필요하다면 flow chart 같은 시각적인 도구가 있으면 좋을것 같음. mermaid 사용시 특수문자 처리 잘 해줘.

그리고 해당 내용을 바탕으로 예제 코드까지 kotlin 으로 작성해줘.
예제 코드는 as-is to-be 형태로 해줬으면 좋겠어.
추가로 예제 코드는 비지니스 즉 도메인이 있는 로직이였으면 좋겠어.

마지막은 요약해서 정리해줘

mermaid example 특수문자의 경우 따움표를 잘 붙여줘.
```mermaid
  flowchart LR
    A([Begin]) --> B["tm1.getTransaction()"]
    B --> C["tm2.getTransaction()"]
    C --> D{비즈니스 로직 수행}
    D --> E["tm2.commit()"]
    E --> F["tm1.commit()"]
    D -- "예외 발생" --> G["tm2.rollback()"]
    G --> H["tm1.rollback()"]
  ```

---


이 코드가 어떻게 스프링 프레임워크 위에서 동작되는지 매우 자세하게 알고 싶은데
flow chart 같은 시각적인 도구가 있으면 좋을것 같음.


# 멀티 소스의 예제 코드 작성
해당 코드는 Kotlin, Spring boot, Spring JPA 등으로 구현
A, B 서로 다른 데이터 베이스를 가진 시스템
A는 Mysql, B는 PostgreSql로 구성함.
Spring 에서는 A DB를 서비스에 필요한 엔티티를 저장하는 용도로 사용하고 B는 통계 데이터를 저장한다.
일부 서비스에서 A에서는 Campaign이라는 엔티티를 저장하고 업데이트 할때 Spring에서 제공하는 이벤트를 발행한다.
이때 이벤트를 Listener가 통계 서비스의 CampaignBudgetBalance 라는 테이블에 업데이트를 시도 함.

이벤트 처리는 순수 Spring 기능으로 구현 DB는 도커로 구현
위에서 이야기 한 것과 같이 Campaign 엔티티를 저장 및 업데이트 할때 이벤트를 발행하여 CampaignBudgetBalance 업데이트 하는 코드를 구현해줘.
단 이벤트는 CampaignBudgetBalance를 바로 접근하는 것이 아니라 해당 엔티티의 서비스 인터페이스를 호출해야 함.

이때 실험해 보고 싶은건 여러가지가 있음.
1. 다른 DB간에 완벽하게 트랜잭션 처리 되는 코드
2. A가 커밋된 이후 B만 따로 트랜잭션 처리
  - 2번의 경우 예외 처리를 통해서 재 처리를 추후에 할수 있도록 보안
3. A가 커밋된 이후 B처리를 비동기로 처리.


여기서 추가로 하고 싶은것이 있음.
CampaignBudgetBalance는
광고가 서빙될때 단가가 차감되어 Update 되는 로직이 있음. 이때 서빙되는 로직을 간단하게 구현하고 단가 차감하는 update 로직도 같이 추가 해줘.
그리고 위에서 CampaignBudgetBalance 예산이 업데이트 될때는 Transaction Lock이 필요함.

테스트를 해보고 싶은건 서빙을 0.5초마다 계속 수행하면서 CampaignBudgetBalance 예산이 업데이트가 안전하게 되는지를 테스트하고 싶어.


---
격리 수준 별 예제 코드를 작성해줘. 도메인 베이스로 이해하기 편한 케이스였으면 좋겠음.
각 케이스별로 flow chart 같은 시각적인 도구로 표현해줘도 좋을것 같음.

예제코드에는 도메인에 대한 설명과, 동작에 대한 설명, 그리고 그외 추가 코멘트, 그리고 출력값이 있다면 따로 정리 해줘.