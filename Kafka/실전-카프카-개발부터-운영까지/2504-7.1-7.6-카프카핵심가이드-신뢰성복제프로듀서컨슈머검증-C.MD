# ğŸ“˜ ì œ7ì¥ â€” ì‹ ë¢°ì„± ìˆëŠ” ë°ì´í„° ì „ë‹¬


## ğŸ§© 7.1 ì‹ ë¢°ì„± ë³´ì¥ (Guarantees)

### ğŸ“ í•µì‹¬ ìš”ì•½

* **ì‹ ë¢°ì„±(reliability)** ì€ ë‹¨ì¼ êµ¬ì„±ìš”ì†Œê°€ ì•„ë‹Œ **ì‹œìŠ¤í…œ ì „ì²´ì˜ ì†ì„±**ì„.
* KafkaëŠ” **íŠ¸ë ˆì´ë“œì˜¤í”„ ê°€ëŠ¥í•œ ì‹ ë¢°ì„± ëª¨ë¸**ì„ ì œê³µí•¨.
* ìš´ì˜ì, ê°œë°œì, ì¸í”„ë¼ ì—”ì§€ë‹ˆì–´ ëª¨ë‘ì˜ ì±…ì„.

### âš™ï¸ Kafkaì˜ í•µì‹¬ ë³´ì¥

| í•­ëª©              | ë³´ì¥ ë‚´ìš©                                             |
| --------------- | ------------------------------------------------- |
| ë©”ì‹œì§€ ìˆœì„œ          | íŒŒí‹°ì…˜ ë‚´ ìˆœì„œ ë³´ì¥ (`A â†’ B` ìˆœì„œë¡œ ì“°ë©´ ë™ì¼ í”„ë¡œë“€ì„œ ê¸°ì¤€ ë™ì¼ ìˆœì„œë¡œ ì½í˜) |
| ì»¤ë°‹(Commit)      | ëª¨ë“  ì¸ì‹±í¬ ë ˆí”Œë¦¬ì¹´(ISR)ì— ê¸°ë¡ëœ í›„ ì»¤ë°‹ë¨                       |
| ë‚´êµ¬ì„±(Durability) | ìµœì†Œ 1ê°œ ë ˆí”Œë¦¬ì¹´ê°€ ì‚´ì•„ìˆëŠ” í•œ ì»¤ë°‹ëœ ë©”ì‹œì§€ëŠ” ìœ ì‹¤ë˜ì§€ ì•ŠìŒ               |
| ì»¨ìŠˆë¨¸             | ì»¤ë°‹ëœ ë©”ì‹œì§€ë§Œ ì½ìŒ                                       |

> ğŸ’¡ Kafkaì˜ ì‹ ë¢°ì„±ì€ ì™„ë²½í•˜ì§€ ì•Šë‹¤ â€”
> â€˜ê°€ìš©ì„± vs ì¼ê´€ì„±â€™ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ì„¤ì •ì— ë”°ë¼ ì¡°ì ˆ ê°€ëŠ¥.

---

## ğŸ” 7.2 ë³µì œ (Replication)

### ğŸ“ êµ¬ì¡° ìš”ì•½

* ê° **í† í”½ = ì—¬ëŸ¬ íŒŒí‹°ì…˜**ìœ¼ë¡œ êµ¬ì„±
* ê° **íŒŒí‹°ì…˜ = ì—¬ëŸ¬ ë ˆí”Œë¦¬ì¹´(replica)** ë¡œ êµ¬ì„±
* í•˜ë‚˜ëŠ” **ë¦¬ë”(Leader)**, ë‚˜ë¨¸ì§€ëŠ” **íŒ”ë¡œì›Œ(Follower)**

### ğŸ§  ì¸ì‹±í¬ ë ˆí”Œë¦¬ì¹´(ISR)

* ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•´ì•¼ ì¸ì‹±í¬ ìƒíƒœ:

    1. ì£¼í‚¤í¼ì™€ì˜ ì„¸ì…˜ í™œì„± (ê¸°ë³¸ 6~18ì´ˆ ë‚´ í•˜íŠ¸ë¹„íŠ¸)
    2. ìµœê·¼ 10~30ì´ˆ ë‚´ ë¦¬ë”ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ì •ìƒì ìœ¼ë¡œ ì½ìŒ
    3. ë³µì œ ì§€ì—°(lag)ì´ ì„¤ì •ê°’ ì´í•˜

> ğŸ’¡ ISR ìˆ˜ê°€ ì ì–´ì§ˆìˆ˜ë¡ â†’ ì²˜ë¦¬ì†ë„ëŠ” ë¹¨ë¼ì§€ì§€ë§Œ
> ë‚´êµ¬ì„±ê³¼ ì¥ì•  ë³µêµ¬ ëŠ¥ë ¥ì€ ë‚®ì•„ì§.

---

## âš™ï¸ 7.3 ë¸Œë¡œì»¤ ì„¤ì • (Broker-Level Reliability)

Kafka ì‹ ë¢°ì„±ì˜ ê·¼ê°„ì€ **ë³µì œ íŒ©í„° / ë¦¬ë” ì„ ì¶œ ì •ì±… / ì¸ì‹±í¬ ë ˆí”Œë¦¬ì¹´ ê´€ë¦¬ / ë””ìŠ¤í¬ í”ŒëŸ¬ì‹œ ì •ì±…**ì„.

---

### 7.3.1 ë³µì œ íŒ©í„° (Replication Factor)

| í•­ëª©                           | ì„¤ëª…            |
| ---------------------------- | ------------- |
| `replication.factor`         | í† í”½ë³„ ë³µì œ ê°œìˆ˜     |
| `default.replication.factor` | ìë™ ìƒì„± í† í”½ì˜ ê¸°ë³¸ê°’ |
| ì¼ë°˜ê°’                          | 3 (ì¶”ì²œ)        |

#### ğŸ“Š íŠ¸ë ˆì´ë“œì˜¤í”„

| ìš”ì¸          | ì˜í–¥                     |
| ----------- | ---------------------- |
| ê°€ìš©ì„±         | ë†’ì„ìˆ˜ë¡ ì•ˆì •                |
| ë‚´êµ¬ì„±         | ë³µì œë³¸ì´ ë§ì„ìˆ˜ë¡ ì•ˆì „           |
| ì²˜ë¦¬ëŸ‰         | ë‚®ì„ìˆ˜ë¡ ë¹ ë¦„                |
| ë¹„ìš©          | ë†’ì„ìˆ˜ë¡ ë¹„ìŒˆ                |
| ì§€ì—°(latency) | ë†’ì„ìˆ˜ë¡ ì¼ë¶€ ë¸Œë¡œì»¤ê°€ ëŠë¦´ ê°€ëŠ¥ì„± ì¦ê°€ |

> âš ï¸ ë™ ë‹¨ìœ„ ì¥ì•  ëŒ€ë¹„:
> `broker.rack` ì„¤ì •ìœ¼ë¡œ ë‹¤ë¥¸ ë™/ê°€ìš©ì˜ì—­ì— ë¶„ì‚° ì €ì¥ ê¶Œì¥.

---

### 7.3.2 ì–¸í´ë¦° ë¦¬ë” ì„ ì¶œ (Unclean Leader Election)

| ì„¤ì •                               | ì„¤ëª…                       |
| -------------------------------- | ------------------------ |
| `unclean.leader.election.enable` | ì•„ì›ƒì˜¤ë¸Œì‹±í¬ ë ˆí”Œë¦¬ì¹´ë¥¼ ë¦¬ë”ë¡œ í—ˆìš©í• ì§€ ì—¬ë¶€ |
| ê¸°ë³¸ê°’                              | `false` (ê°€ì¥ ì•ˆì „)          |

#### ğŸ“‰ íŠ¸ë ˆì´ë“œì˜¤í”„

| ì„ íƒ      | ì¥ì         | ë‹¨ì            |
| ------- | --------- | ------------ |
| `true`  | ê°€ìš©ì„± â†‘     | ë°ì´í„° ìœ ì‹¤ ê°€ëŠ¥    |
| `false` | ë°ì´í„° ë¬´ê²°ì„± â†‘ | ë³µêµ¬ ì „ê¹Œì§€ ì½ê¸° ë¶ˆê°€ |

> ğŸ’¡ ì¼ë°˜ì ìœ¼ë¡œ `false` ê¶Œì¥.
> ë‹¨, ê¸´ê¸‰ ë³µêµ¬ ì‹œ `true`ë¡œ ì¼ì‹œ ë³€ê²½ í›„ ë³µêµ¬ í›„ ë‹¤ì‹œ `false`.

---

### 7.3.3 ìµœì†Œ ì¸ì‹±í¬ ë ˆí”Œë¦¬ì¹´ (min.insync.replicas)

| ì„¤ì •                    | ì„¤ëª…                |
| --------------------- | ----------------- |
| `min.insync.replicas` | ì»¤ë°‹ ì‹œ í•„ìš”í•œ ìµœì†Œ ISR ìˆ˜ |
| ê¸°ë³¸ê°’                   | 1                 |
| ê¶Œì¥ê°’                   | ë³µì œ íŒ©í„° 3ì¼ ë•Œ ìµœì†Œ 2   |

> ğŸ’¡ `acks=all` + `min.insync.replicas=2` â†’
> ë¦¬ë”+íŒ”ë¡œì›Œ ìµœì†Œ 2ê³³ì— ì €ì¥ë˜ì–´ì•¼ ì»¤ë°‹ ì™„ë£Œ.

---

### 7.3.4 ë ˆí”Œë¦¬ì¹´ ISR ìœ ì§€ (Replica Lag Settings)

| ì„¤ì •                             | ì„¤ëª…                      | ê¸°ë³¸ê°’      |
| ------------------------------ | ----------------------- | -------- |
| `zookeeper.session.timeout.ms` | ì£¼í‚¤í¼ í•˜íŠ¸ë¹„íŠ¸ íƒ€ì„ì•„ì›ƒ           | 18,000ms |
| `replica.lag.time.max.ms`      | ë¦¬ë”ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ëª» ë°›ì€ ìµœëŒ€ í—ˆìš©ì‹œê°„ | 30,000ms |

---

### 7.3.5 ë””ìŠ¤í¬ ì €ì¥ (Flush Policy)

| ì„¤ì •               | ì„¤ëª…                 |
| ---------------- | ------------------ |
| `flush.messages` | ë””ìŠ¤í¬ í”ŒëŸ¬ì‹œ ì „ ìµœëŒ€ ë©”ì‹œì§€ ìˆ˜ |
| `flush.ms`       | ë””ìŠ¤í¬ í”ŒëŸ¬ì‹œ ì£¼ê¸°(ms)     |

> ğŸ’¡ ê¸°ë³¸ì ìœ¼ë¡œ KafkaëŠ” OS í˜ì´ì§€ ìºì‹œì— ì˜ì¡´í•¨.
> ë””ìŠ¤í¬ í”ŒëŸ¬ì‹œ ë¹ˆë„ë¥¼ ë†’ì´ë©´ ì‹ ë¢°ì„±â†‘, ì²˜ë¦¬ëŸ‰â†“

---

## âœ‰ï¸ 7.4 ì‹ ë¢°ì„± ìˆëŠ” í”„ë¡œë“€ì„œ ì„¤ì •

### 7.4.1 Acks ì„¤ì • (ì‘ë‹µ ëª¨ë“œ)

| `acks` ê°’ | ì˜ë¯¸              | ì‹ ë¢°ì„±   | ì§€ì—°    |
| -------- | --------------- | ----- | ----- |
| `0`      | ë„¤íŠ¸ì›Œí¬ ì „ì†¡ ì‹œ ì„±ê³µ ì²˜ë¦¬ | ë§¤ìš° ë‚®ìŒ | ë§¤ìš° ë¹ ë¦„ |
| `1`      | ë¦¬ë”ì— ê¸°ë¡ í›„ ì‘ë‹µ     | ì¤‘ê°„    | ì¤‘ê°„    |
| `all`    | ëª¨ë“  ISRì— ë³µì œ í›„ ì‘ë‹µ | ìµœê³     | ëŠë¦¼    |

> âœ… **ì¶”ì²œ:** `acks=all` + `enable.idempotence=true`

---

### 7.4.2 í”„ë¡œë“€ì„œ ì¬ì‹œë„ (Retries)

| ì„¤ì •                    | ì„¤ëª…          | ê¶Œì¥ê°’       |
| --------------------- | ----------- | --------- |
| `retries`             | ì¬ì‹œë„ íšŸìˆ˜      | `MAX_INT` |
| `delivery.timeout.ms` | ì „ì²´ ì¬ì‹œë„ íƒ€ì„ì•„ì›ƒ | ì¶©ë¶„íˆ í¬ê²Œ    |
| `enable.idempotence`  | ì¤‘ë³µ ë°©ì§€       | `true`    |

> ğŸ’¡ ì¬ì‹œë„ëŠ” ìµœì†Œ â€œí•œ ë²ˆ(at least once)â€ ë³´ì¥ì„ í•˜ì§€ë§Œ
> ë©±ë“±ì„±(idempotence)ì„ ì¼œë©´ â€œì •í™•íˆ í•œ ë²ˆ(exactly once)â€ì— ê·¼ì ‘ ê°€ëŠ¥.

---

### 7.4.3 ì¶”ê°€ ì—ëŸ¬ ì²˜ë¦¬

* ì§ë ¬í™” ì‹¤íŒ¨, ì¸ì¦/ì¸ê°€ ì‹¤íŒ¨, íƒ€ì„ì•„ì›ƒ ë“±ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì²˜ë¦¬ í•„ìš”.
* â€œë°ë“œë ˆí„° í(Dead Letter Queue)â€ íŒ¨í„´ ê¶Œì¥:
  ì‹¤íŒ¨ ë©”ì‹œì§€ë¥¼ ë³„ë„ í† í”½ì— ê¸°ë¡ í›„ ì¬ì²˜ë¦¬.

---

## ğŸ§­ 7.5 ì‹ ë¢°ì„± ìˆëŠ” ì»¨ìŠˆë¨¸ ì„¤ì •

### 7.5.1 ì£¼ìš” ì„¤ì •

| ì„¤ì •                        | ì„¤ëª…                                  |
| ------------------------- | ----------------------------------- |
| `group.id`                | ì»¨ìŠˆë¨¸ ê·¸ë£¹ ì‹ë³„ì                          |
| `auto.offset.reset`       | ì˜¤í”„ì…‹ ì—†ìŒ ì‹œ ë™ì‘ (`earliest` / `latest`) |
| `enable.auto.commit`      | ì˜¤í”„ì…‹ ìë™ ì»¤ë°‹ ì—¬ë¶€                        |
| `auto.commit.interval.ms` | ìë™ ì»¤ë°‹ ì£¼ê¸° (ê¸°ë³¸ 5ì´ˆ)                    |

> âš ï¸ ìë™ ì»¤ë°‹ ì‹œ ì¤‘ë³µ/ëˆ„ë½ ìœ„í—˜ ì¡´ì¬.
> ë³µì¡í•œ ì²˜ë¦¬ ë¡œì§ì´ ìˆë‹¤ë©´ ìˆ˜ë™ ì»¤ë°‹(`commitSync`) ì‚¬ìš© ê¶Œì¥.

---

### 7.5.2 ëª…ì‹œì  ì˜¤í”„ì…‹ ì»¤ë°‹ ì „ëµ

| íŒ¨í„´          | ì„¤ëª…               |
| ----------- | ---------------- |
| ì²˜ë¦¬ í›„ ì»¤ë°‹     | ì•ˆì „í•˜ì§€ë§Œ ì§€ì—° ë°œìƒ ê°€ëŠ¥   |
| ì£¼ê¸°ì  ì»¤ë°‹      | ì„±ëŠ¥ â†‘, ì¬ì‹œì‘ ì‹œ ì¤‘ë³µ â†‘ |
| ë¦¬ë°¸ëŸ°ìŠ¤ ì‹œ ì»¤ë°‹   | ì•ˆì „í•œ ì¢…ë£Œë¥¼ ìœ„í•´ í•„ìš”    |
| ì¬ì‹œë„ / ë°ë“œë ˆí„°í | ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ ë³„ë„ í† í”½ìœ¼ë¡œ  |

> ğŸ’¡ `commitSync()`ëŠ” ì •í™•ì„± â†‘, `commitAsync()`ëŠ” ì„±ëŠ¥ â†‘.
> ìƒí™©ì— ë§ê²Œ ì¡°í•© ì‚¬ìš©.

---

## ğŸ” 7.6 ì‹œìŠ¤í…œ ì‹ ë¢°ì„± ê²€ì¦

KafkaëŠ” ë‹¨ìˆœ ì„¤ì •ë§Œìœ¼ë¡œ ì‹ ë¢°ì„±ì´ ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤.
**í…ŒìŠ¤íŠ¸ â†’ ê²€ì¦ â†’ ëª¨ë‹ˆí„°ë§** 3ë‹¨ê³„ê°€ í•„ìˆ˜ë‹¤.

---

### 7.6.1 ì„¤ì • ê²€ì¦ (Configuration Validation)
#### ğŸ¯ ëª©ì 
Kafkaë¥¼ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ê¸° ì „ì—,
- ìš°ë¦¬ê°€ ì„¤ì •í•œ ê°’(acks, retries, delivery.timeout.ms, replication.factor ë“±)ì´
ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€,
- ì¥ì•  ìƒí™©ì—ì„œë„ ë°ì´í„° ì†ì‹¤ ì—†ì´ ì •ìƒ ë³µêµ¬ë˜ëŠ”ì§€ë¥¼
**ì‚¬ì „ì— ê²€ì¦(í…ŒìŠ¤íŠ¸)**í•˜ê¸° ìœ„í•œ ì ˆì…ë‹ˆë‹¤.

> ìš”ì•½í•˜ìë©´:
â€œKafkaë¥¼ ìš´ì˜ì— ì˜¬ë¦¬ê¸° ì „ì—, ì§„ì§œ ì„¤ì •ì´ ìš°ë¦¬ê°€ ê¸°ëŒ€í•œ ëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ ë¯¸ë¦¬ ì‹¤í—˜í•´ë³´ì.â€


#### Kafkaê°€ ì œê³µí•˜ëŠ” ê²€ì¦ ë„êµ¬

Kafka `org.apache.kafka.tools` íŒ¨í‚¤ì§€ì—ëŠ” ì•„ë˜ ë‘ ë„êµ¬ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

| ë„êµ¬ëª…                    | ì—­í•        | íŠ¹ì§•                   |
| ---------------------- | -------- | -------------------- |
| **VerifiableProducer** | ê²€ì¦ìš© í”„ë¡œë“€ì„œ | ìˆœì„œëŒ€ë¡œ ìˆ«ìê°€ í¬í•¨ëœ ë©”ì‹œì§€ë¥¼ ë³´ëƒ„ |
| **VerifiableConsumer** | ê²€ì¦ìš© ì»¨ìŠˆë¨¸  | ë°›ì€ ë©”ì‹œì§€ë¥¼ ìˆœì„œëŒ€ë¡œ ì½ì–´ ê²€ì¦   |

> ë‘ ë„êµ¬ ëª¨ë‘ CLI(ëª…ë ¹í–‰)ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê³ ,
> ìë™í™” í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥.

---

## ğŸ§ª 3ï¸âƒ£ ê²€ì¦ìš© í”„ë¡œë“€ì„œ ë™ì‘ ë°©ì‹

* 1ë¶€í„° nê¹Œì§€ **ìˆœì„œëŒ€ë¡œ ìˆ«ìê°€ í¬í•¨ëœ ë©”ì‹œì§€ë¥¼ ì „ì†¡**í•©ë‹ˆë‹¤.
* ì¼ë°˜ í”„ë¡œë“€ì„œì™€ ë™ì¼í•˜ê²Œ `acks`, `retries`, `delivery.timeout.ms` ë“±ì˜ ì„¤ì •ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
* ê° ë©”ì‹œì§€ ì „ì†¡ ê²°ê³¼(ì„±ê³µ/ì—ëŸ¬)ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
* ì´ê±¸ í†µí•´ â€œí˜„ì¬ ì„¤ì •ì´ ì•ˆì •ì ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ì¥í•˜ëŠ”ì§€â€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ” 4ï¸âƒ£ ê²€ì¦ìš© ì»¨ìŠˆë¨¸ ë™ì‘ ë°©ì‹

* VerifiableProducerê°€ ë³´ë‚¸ ë©”ì‹œì§€ë¥¼ ê·¸ëŒ€ë¡œ ì½ì–´ì˜µë‹ˆë‹¤.
* ë°›ì€ ë©”ì‹œì§€ ìˆœì„œ, ëˆ„ë½ ì—¬ë¶€, ì»¤ë°‹ ìƒíƒœ ë“±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
* **í”„ë¡œë“€ì„œ â†’ ë¸Œë¡œì»¤ â†’ ì»¨ìŠˆë¨¸** ì „ì²´ ì²´ì¸ì„ ê²€ì¦í•˜ëŠ” ì…ˆì…ë‹ˆë‹¤.

---

## ğŸ§© 5ï¸âƒ£ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ

KafkaëŠ” ë‹¨ìˆœíˆ ë©”ì‹œì§€ ì „ì†¡ë¿ ì•„ë‹ˆë¼, ì¥ì•  ìƒí™©ì„ ì¼ë¶€ëŸ¬ ë§Œë“¤ì–´ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ëŠ” ê±¸ ê¶Œì¥í•©ë‹ˆë‹¤.

| ì‹œë‚˜ë¦¬ì˜¤              | í…ŒìŠ¤íŠ¸ ë‚´ìš©                       | í™•ì¸ í¬ì¸íŠ¸               |
| ----------------- | ---------------------------- | -------------------- |
| **ë¦¬ë” ì„ ì¶œ í…ŒìŠ¤íŠ¸**     | ë¦¬ë” ë¸Œë¡œì»¤ë¥¼ ê°•ì œë¡œ ì¤‘ë‹¨ì‹œí‚¤ë©´?           | ë¦¬ë” ì¬ì„ ì¶œ ì‹œê°„, ë©”ì‹œì§€ ì†ì‹¤ ì—¬ë¶€ |
| **ì»¨íŠ¸ë¡¤ëŸ¬ ì¬ì‹œì‘ í…ŒìŠ¤íŠ¸**  | ì»¨íŠ¸ë¡¤ëŸ¬ ë¸Œë¡œì»¤ë¥¼ ì¬ì‹œì‘í•˜ë©´?             | ì‹œìŠ¤í…œì´ ì–¼ë§ˆë‚˜ ë¹¨ë¦¬ íšŒë³µë˜ëŠ”ê°€    |
| **ë¡¤ë§ ì¬ì‹œì‘ í…ŒìŠ¤íŠ¸**    | ë¸Œë¡œì»¤ë¥¼ í•˜ë‚˜ì”© ìˆœì°¨ ì¬ì‹œì‘              | ë©”ì‹œì§€ ìœ ì‹¤ ì—†ì´ ìœ ì§€ë˜ëŠ”ê°€      |
| **ì–¸í´ë¦° ë¦¬ë” ì„ ì¶œ í…ŒìŠ¤íŠ¸** | Out-of-Sync ë ˆí”Œë¦¬ì¹´ë¥¼ ë¦¬ë”ë¡œ ì„ ì¶œí•  ê²½ìš° | ë©”ì‹œì§€ ì¼ê´€ì„± ìœ ì§€ ì—¬ë¶€        |

---

## ğŸ§  6ï¸âƒ£ ê²€ì¦ ì ˆì°¨ ì˜ˆì‹œ

1. **ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ**
   â†’ ì˜ˆ: â€œë¦¬ë” ë¸Œë¡œì»¤ ê°•ì œ ì¤‘ë‹¨ ì‹œ í…ŒìŠ¤íŠ¸â€
2. **VerifiableProducer ì‹¤í–‰**
   â†’ ë©”ì‹œì§€ë¥¼ ì—°ì†ì ìœ¼ë¡œ ì†¡ì‹ 
3. **VerifiableConsumer ì‹¤í–‰**
   â†’ ë©”ì‹œì§€ë¥¼ ì—°ì†ì ìœ¼ë¡œ ìˆ˜ì‹  ë° ê²€ì¦
4. **ì¥ì•  ìœ ë°œ (ë¦¬ë” ì¤‘ë‹¨, ë¸Œë¡œì»¤ ì¬ì‹œì‘ ë“±)**
   â†’ ë©”ì‹œì§€ ìœ ì‹¤ ì—¬ë¶€ í™•ì¸
5. **ê²°ê³¼ ë¹„êµ**
   â†’ ë³´ë‚¸ ë©”ì‹œì§€ ìˆ˜ == ë°›ì€ ë©”ì‹œì§€ ìˆ˜ë¼ë©´ ì„¤ì • ê²€ì¦ ì„±ê³µ âœ…

---

## ğŸ’» 7ï¸âƒ£ ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìœ„ì¹˜

Kafka ì˜¤í”ˆì†ŒìŠ¤ì—ëŠ” ì´ëŸ° í…ŒìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ëŒë¦¬ëŠ” **í…ŒìŠ¤íŠ¸ ìŠ¤ìœ„íŠ¸(test suite)**ê°€ í¬í•¨ë¼ ìˆìŠµë‹ˆë‹¤.
ğŸ“ [GitHub ë§í¬](https://github.com/apache/kafka/tree/trunk/tests)

* ì—¬ê¸°ì„œ VerifiableProducerì™€ VerifiableConsumerë¥¼ í™œìš©í•œ ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ê°€ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* ì˜ˆ: ì—…ê·¸ë ˆì´ë“œ ì‹œ ë©”ì‹œì§€ ì†ì‹¤ì´ ì—†ëŠ”ì§€, ë¦¬ë” ì¬ì„ ì¶œ í›„ì—ë„ ìˆœì„œ ë³´ì¥ì´ ë˜ëŠ”ì§€ ë“±.

---

## ğŸ§¾ ìš”ì•½ ì •ë¦¬

| í•­ëª©     | ì„¤ëª…                                      |
| ------ | --------------------------------------- |
| ëª©ì      | ì„¤ì •ì´ ì‹¤ì œë¡œ ì˜ë„ëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸                   |
| ì£¼ìš” ë„êµ¬  | VerifiableProducer / VerifiableConsumer |
| ê²€ì¦ ë°©ì‹  | ìˆœì°¨ ë©”ì‹œì§€ ì†¡ì‹  â†’ ì¥ì•  ìœ ë°œ â†’ ìˆ˜ì‹  í™•ì¸               |
| ì£¼ìš” í…ŒìŠ¤íŠ¸ | ë¦¬ë” ì„ ì¶œ, ì»¨íŠ¸ë¡¤ëŸ¬ ì¬ì‹œì‘, ë¡¤ë§ ì¬ì‹œì‘, ì–¸í´ë¦° ë¦¬ë” ì„ ì¶œ      |
| ê²°ê³¼ íŒë‹¨  | ë³´ë‚¸ ë©”ì‹œì§€ ìˆ˜ == ë°›ì€ ë©”ì‹œì§€ ìˆ˜ â†’ ì„±ê³µ               |

---

### 7.6.2 ì• í”Œë¦¬ì¼€ì´ì…˜ ê²€ì¦

* ì»¤ìŠ¤í…€ ì—ëŸ¬ ì²˜ë¦¬ / ì˜¤í”„ì…‹ ì»¤ë°‹ ë¡œì§ í™•ì¸
* `Trogdor` í”„ë ˆì„ì›Œí¬ë¡œ ë„¤íŠ¸ì›Œí¬ ì¥ì•  ì£¼ì… í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
* í†µí•© í…ŒìŠ¤íŠ¸ ì‹œ â€œì˜ˆìƒ ë™ì‘â€ê³¼ ì‹¤ì œ ê²°ê³¼ ë¹„êµ í•„ìˆ˜

---

### 7.6.3 í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§

| í•­ëª©    | ì§€í‘œ                                       | ì˜ë¯¸               |
| ----- | ---------------------------------------- | ---------------- |
| í”„ë¡œë“€ì„œ  | `record-error-rate`, `record-retry-rate` | ì „ì†¡ ì‹¤íŒ¨/ì¬ì‹œë„ìœ¨       |
| ì»¨ìŠˆë¨¸   | `consumer-lag`                           | íŒŒí‹°ì…˜ë³„ ì½ê¸° ì§€ì—°       |
| ì „ì†¡ íë¦„ | ì´ë²¤íŠ¸ ìƒì„±â†’ì†Œë¹„ ê°„ íƒ€ì„ìŠ¤íƒ¬í”„ ì°¨ì´                     | end-to-end ì§€ì—° ì¸¡ì • |

> ğŸ§  **Burrow** (by LinkedIn): ì»¨ìŠˆë¨¸ ë™ ëª¨ë‹ˆí„°ë§ì— ì í•©
> **JMX Metrics** + **Alerting Rule** ì¡°í•©ìœ¼ë¡œ ìš´ì˜ í™˜ê²½ì—ì„œ ê²€ì¦

---

## ğŸ’» Kotlin ì‹¤ë¬´ ì˜ˆì œ

### As-Is: ë‹¨ìˆœ Ack=1 í”„ë¡œë“€ì„œ

```kotlin
val props = Properties().apply {
    put("bootstrap.servers", "localhost:9092")
    put("acks", "1") // ë¦¬ë”ë§Œ ì‘ë‹µ
    put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer")
    put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer")
}
val producer = KafkaProducer<String, String>(props)
producer.send(ProducerRecord("order-topic", "orderId-1", "paymentSuccess"))
```

---

### To-Be: ì‹ ë¢°ì„± ê°•í™”í˜• (acks=all + ë©±ë“±ì„± + ì¬ì‹œë„ + DLQ)

```kotlin
val props = Properties().apply {
    put("bootstrap.servers", "localhost:9092")
    put("acks", "all")
    put("enable.idempotence", "true")
    put("retries", Int.MAX_VALUE.toString())
    put("delivery.timeout.ms", "120000")
    put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer")
    put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer")
}

val producer = KafkaProducer<String, String>(props)

fun sendOrderEvent(orderId: String, payload: String) {
    try {
        producer.send(ProducerRecord("order-topic", orderId, payload)).get()
    } catch (e: Exception) {
        // DLQë¡œ ì „ì†¡
        producer.send(ProducerRecord("order-dlq", orderId, payload))
    }
}
```

---

### Kotest ì˜ˆì‹œ

```kotlin
class ReliableProducerTest : StringSpec({
    "should send to DLQ when broker fails" {
        val producer = mockk<KafkaProducer<String, String>>(relaxed = true)
        every { producer.send(any()) } throws Exception("Simulated failure")

        val dlqProducer = ReliableProducer(producer)
        dlqProducer.sendOrderEvent("123", "payload")
        verify { producer.send(match { it.topic() == "order-dlq" }) }
    }
})
```

---

## ğŸ§­ ì „ì²´ ìš”ì•½í‘œ

| ë²”ì£¼            | í•µì‹¬ ë‚´ìš©                                               | ì‹¤ë¬´ í¬ì¸íŠ¸                                 |
| ------------- | --------------------------------------------------- | -------------------------------------- |
| **ë³´ì¥(7.1)**   | ìˆœì„œ, ì»¤ë°‹, ë‚´êµ¬ì„±                                         | KafkaëŠ” ì„¤ì • ê¸°ë°˜ ì‹ ë¢°ì„± ì œê³µ                    |
| **ë³µì œ(7.2)**   | ISR / ë¦¬ë”-íŒ”ë¡œì›Œ                                        | lag ê´€ë¦¬ê°€ í•µì‹¬                             |
| **ë¸Œë¡œì»¤(7.3)**  | replication.factor / min.insync.replicas / flush ì •ì±… | íŠ¸ë ˆì´ë“œì˜¤í”„ ì¡°ì ˆ                              |
| **í”„ë¡œë“€ì„œ(7.4)** | acks / ì¬ì‹œë„ / ë©±ë“±ì„±                                    | `acks=all` + `enable.idempotence=true` |
| **ì»¨ìŠˆë¨¸(7.5)**  | ì»¤ë°‹ ì „ëµ / ë¦¬ë°¸ëŸ°ìŠ¤ ì²˜ë¦¬                                     | ìë™ ì»¤ë°‹ ì§€ì–‘, ëª…ì‹œì  ì»¤ë°‹ ê¶Œì¥                    |
| **ê²€ì¦(7.6)**   | ì„¤ì •, ì½”ë“œ, ëª¨ë‹ˆí„°ë§                                        | TrogdorÂ·Burrow ë“±ìœ¼ë¡œ ì§€ì† í…ŒìŠ¤íŠ¸              |

---

## ğŸ“š ì°¸ê³  ë§í¬

* [KIP-98: Exactly Once Semantics](https://cwiki.apache.org/confluence/display/KAFKA/KIP-98)
* [Kafka Reliability & Idempotence Guide (Confluent)](https://www.confluent.io/blog/transactions-apache-kafka/)
* [LinkedIn Burrow - Consumer Lag Monitoring](https://github.com/linkedin/Burrow)

---
