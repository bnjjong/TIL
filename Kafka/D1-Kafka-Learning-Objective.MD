ì•„ë˜ëŠ” 1ì¼ì°¨ â€œìŠ¤í„°ë”” ê°œìš” ë° ëª©í‘œ ì„¤ì •â€ ì„¸ì…˜ì˜ êµ¬ì„±ì•ˆì…ë‹ˆë‹¤.

---

## 1. ì •ì˜ ë° ê°œë… ì •ë¦¬

### 1.1 í•™ìŠµ ëª©í‘œ(Learning Objectives)

* **Kafka ì´í•´**: ìŠ¤íŠ¸ë¦¬ë° í”Œë«í¼ìœ¼ë¡œì„œì˜ Kafka ì—­í• ê³¼ ì¥ë‹¨ì  íŒŒì•…
* **Spring Boot ì—°ë™ ì¤€ë¹„**: `spring-kafka` ëª¨ë“ˆ ê¸°ë°˜ì˜ í”„ë¡œë“€ì„œ/ì»¨ìŠˆë¨¸ ê°œë°œ ê¸°ë°˜ ë§ˆë ¨
* **ìš´ì˜ í™˜ê²½ ìˆ™ì§€**: AWS MSK(Amazon Managed Streaming for Apache Kafka) ì•„í‚¤í…ì²˜ì™€ ì„¤ì •
* **ë„ë©”ì¸ ì´í•´**: ê´‘ê³  í†µê³„ìš© ì´ë²¤íŠ¸(í´ë¦­Â·ë…¸ì¶œÂ·ì „í™˜) ë¶„ì„ ìš”êµ¬ì‚¬í•­ ì •ë¦¬
* **ì„±ê³¼ ì¸¡ì • ì§€í‘œ**: ì²˜ë¦¬ëŸ‰(Throughput), ì§€ì—°(Latency), ì˜¤ë¥˜ìœ¨(Error Rate) ë“± KPI ìˆ˜ë¦½

### 1.2 ìš´ì˜ í™˜ê²½(AWS MSK) ê°œìš”

* **MSKë€?**

  * AWSì—ì„œ ì œê³µí•˜ëŠ” ì™„ì „ê´€ë¦¬í˜• Kafka ì„œë¹„ìŠ¤
  * í´ëŸ¬ìŠ¤í„° í”„ë¡œë¹„ì €ë‹, ì†Œí”„íŠ¸ì›¨ì–´ íŒ¨ì¹˜, ëª¨ë‹ˆí„°ë§ ìë™í™”
* **ì£¼ìš” êµ¬ì„±ìš”ì†Œ**

  * **Brokers**: Kafka ë…¸ë“œ
  * **Zookeeper/KRaft**: ë©”íƒ€ë°ì´í„° ê´€ë¦¬
  * **IAM & VPC**: ë„¤íŠ¸ì›Œí¬Â·ë³´ì•ˆ
* **ì„¤ì • í¬ì¸íŠ¸**

  * í´ëŸ¬ìŠ¤í„° í¬ê¸°(ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…Â·ìˆ˜)
  * ë³´ì•ˆ(TLS, SASL, IAM ì—­í• )
  * ìŠ¤ì¼€ì¼ ì•„ì›ƒ ì „ëµ

### 1.3 ë„ë©”ì¸(ê´‘ê³  í†µê³„) ê°œìš”

* **ì´ë²¤íŠ¸ ì¢…ë¥˜**

  * **ë…¸ì¶œ(Impression)**, **í´ë¦­(Click)**, **ì „í™˜(Conversion)**
* **ë¶„ì„ ìš”êµ¬ì‚¬í•­**

  * ì‹¤ì‹œê°„ ì§‘ê³„: ë¶„Â·ì‹œê°„ ë‹¨ìœ„ ì§€í‘œ
  * ì •í™•ì„± ë³´ì¥: ìˆœì„œ ë³´ì¥, ì¬ì²˜ë¦¬(idempotence)
  * í™•ì¥ì„±: íŠ¸ë˜í”½ ê¸‰ì¦ ëŒ€ì‘

---

## 2. ì „ì²´ ë¡œë“œë§µ & í‰ê°€ ì§€í‘œ ìˆ˜ë¦½

```mermaid
flowchart TD
  A["ì‹œì‘: ìŠ¤í„°ë”” ê°œìš” ì •ì˜"] --> B["í•™ìŠµ ëª©í‘œ ì„¤ì •"]
  B --> C["AWS MSK í™˜ê²½ ì´í•´"]
  C --> D["ê´‘ê³  í†µê³„ ë„ë©”ì¸ ë¶„ì„"]
  D --> E["ì „ì²´ ë¡œë“œë§µ ìˆ˜ë¦½"]
  E --> F["KPI/í‰ê°€ ì§€í‘œ ì„ ì •"]
  F --> G["ì£¼ì°¨ë³„ ì„¸ë¶€ ê³„íš ì‘ì„±"]
```

* **KPI ì˜ˆì‹œ**

  * ì²˜ë¦¬ëŸ‰: ì´ˆë‹¹ ë©”ì‹œì§€ ì²˜ë¦¬ëŸ‰(msg/s) â‰¥ 10,000
  * ì§€ì—°: í‰ê·  ì²˜ë¦¬ ì§€ì—°(latency) â‰¤ 200ms
  * ê°€ìš©ì„±: ì—°ê°„ ê°€ë™ ì‹œê°„ â‰¥ 99.9%

---

## 3. ì¶”ê°€ ì œì•ˆ í•™ìŠµ ì£¼ì œ

1. **Schema Registry**: Avro/Protobuf ê¸°ë°˜ ìŠ¤í‚¤ë§ˆ ê´€ë¦¬
2. **ë³´ì•ˆ ì‹¬í™”**: ACL, ì•”í˜¸í™” ì˜µì…˜(SASL\_SSL)
3. **ëª¨ë‹ˆí„°ë§ íŒŒì´í”„ë¼ì¸**: JMX â†’ Micrometer â†’ Prometheus â†’ Grafana
4. **í…ŒìŠ¤íŠ¸ ì „ëµ**: `Embedded Kafka í…ŒìŠ¤íŠ¸`, ì»¨ìŠˆë¨¸ ì˜¤í”„ì…‹ ë¦¬ì…‹
5. **ì¸í”„ë¼ ì½”ë“œ**: Terraform/CloudFormationë¡œ MSK í”„ë¡œë¹„ì €ë‹

---

## 4. ì˜ˆì œ ì½”ë“œ (Kotlin)

ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸: ê´‘ê³  ì´ë²¤íŠ¸ ì§‘ê³„ ì„œë¹„ìŠ¤

### 4.1 As-Is: ì¸ë©”ëª¨ë¦¬ ë™ê¸° ì§‘ê³„

```kotlin
data class AdEvent(val adId: String, val type: EventType, val timestamp: Instant)

enum class EventType { IMPRESSION, CLICK, CONVERSION }

class AdStatisticsService {
    // ë‹¨ìˆœ ë™ê¸°ì‹ Map ê¸°ë°˜ ì§‘ê³„
    private val counts = mutableMapOf<String, Int>()

    fun recordEvent(event: AdEvent) {
        val current = counts.getOrDefault(event.adId, 0)
        counts[event.adId] = current + 1
    }

    fun getCount(adId: String): Int =
        counts.getOrDefault(adId, 0)
}
```

### 4.2 To-Be: Spring Kafka ê¸°ë°˜ ë¹„ë™ê¸° ì§‘ê³„

```kotlin
@Service
class KafkaAdStatisticsService(
    private val kafkaTemplate: KafkaTemplate<String, AdEvent>
) {
    // Kafkaë¡œ ì´ë²¤íŠ¸ ë°œí–‰
    fun sendEvent(event: AdEvent) =
        kafkaTemplate.send("ad-events", event.adId, event)

    // Kafka ì»¨ìŠˆë¨¸: listener ë°©ì‹
    @KafkaListener(topics = ["ad-events"], groupId = "stats-group")
    fun listen(event: AdEvent) {
        recordEvent(event)
    }

    // ì•ˆì „í•œ ë™ì‹œì„± ì²˜ë¦¬
    private val counts = ConcurrentHashMap<String, AtomicInteger>()

    private fun recordEvent(event: AdEvent) {
        counts.computeIfAbsent(event.adId) { AtomicInteger(0) }
              .incrementAndGet()
    }

    fun getCount(adId: String): Int =
        counts[adId]?.get() ?: 0
}
```

> **ì„¤ëª…**
>
> * As-Is: ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ Map, ìˆœì„œ ë³´ì¥Â·ì¬ì‹œë„ ë¯¸ì§€ì›
> * To-Be: KafkaListener ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬, ë©€í‹° ì¸ìŠ¤í„´ìŠ¤ í™•ì¥ ê°€ëŠ¥, `ConcurrentHashMap` + `AtomicInteger`ë¡œ ë™ì‹œì„± ì•ˆì „

---

## 5. ìš”ì•½

* **í•™ìŠµ ëª©í‘œ**: Kafka ê°œë…, Spring ì—°ë™, AWS MSK ì´í•´, ê´‘ê³  í†µê³„ ìš”ê±´ ì •ë¦¬
* **ë¡œë“œë§µ**: 4ì£¼(20íšŒì°¨), ê¸°ì´ˆ â†’ ì—°ë™ â†’ íŠœë‹ â†’ ê³ ê¸‰ ê¸°ëŠ¥
* **KPI**: ì²˜ë¦¬ëŸ‰, ì§€ì—°, ê°€ìš©ì„± ë“± ì£¼ìš” ì§€í‘œ ìˆ˜ë¦½
* **ì˜ˆì œ**: As-Is(ë™ê¸° Map ì§‘ê³„) vs To-Be(KafkaListener ê¸°ë°˜ ë¹„ë™ê¸° ì§‘ê³„)

ì´ì œ ë‹¤ìŒ ì„¸ì…˜ë¶€í„° ë³¸ê²©ì ìœ¼ë¡œ Kafka ê¸°ë³¸ ê°œë…ê³¼ í™˜ê²½ êµ¬ì¶•ì„ ì‹œì‘í•´ ë³´ê² ìŠµë‹ˆë‹¤! ğŸ˜Š
